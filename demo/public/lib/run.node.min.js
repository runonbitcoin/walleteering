module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.u)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.u?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=14)}([function(t,e,r){const n=r(2),{Jig,JigControl}=r(3),{Berry}=r(10),StandardLock=r(16);function o(t){return"function"==typeof t&&-1===t.toString().indexOf("[native code]")}function i(t){return JigControl.g(()=>{if(t)return t instanceof Jig?"jig":t instanceof Berry?"berry":o(t)?"code":void 0})}function s(t){return JigControl.g(()=>{switch(typeof t){case"string":return`"${t.length>20?t.slice(0,20)+"â€¦":t}"`;case"object":return t?t.constructor.name?`[object ${t.constructor.name}]`:"[anonymous object]":"null";case"function":{const e=t.toString();return/^\(/.test(e)||/^function\s*\(/.test(e)||/^[a-zA-Z0-9_$]+\s*=>/.test(e)?"[anonymous function]":/^class\s*{/.test(e)?"[anonymous class]":t.name}case"undefined":return"undefined";default:return t.toString()}})}function c(t,e,n=new Set){"function"!=typeof t&&"object"!=typeof t||!t||function(t,e,n){if(n.has(t))return;n.add(t);const o=t=>{"function"!=typeof t&&"object"!=typeof t||!t||e(t)&&c(t,e,n)},i=r(4)._;if(t instanceof i.P.Set||t instanceof i.O.Set)for(const e of t)o(e);if(t instanceof i.P.Map||t instanceof i.O.Map)for(const[e,r]of t)o(e),o(r);Object.keys(t).forEach(e=>o(t[e]))}(t,e,n)}t.exports={A:function(){const t=r(14);if(!t.instance)throw new Error("Run not instantiated");return t.instance},I:function(t){return t.startsWith("main")?"mainnet":"testnet"},j:function(t){switch(t){case"main":return"Mainnet";case"test":return"Testnet";case"stn":return"Stn";case"mock":return"Mocknet";default:throw new Error("Unknown network: "+t)}},$:o,R:i,k:function(t,e){return t===e||t.origin&&"_"!==t.origin[0]&&t.origin===e.origin},F:s,U:function(t){const e=t.toString(),r=Object.getPrototypeOf(t);if(r.prototype){const n=/^class \S+ extends \S+ {/;return e.replace(n,`class ${t.name} extends ${r.name} {`)}const n=e.match(/^([a-zA-Z0-9_$]+)\S*\(/);return n&&"function"!==n[1]?"function "+e:e},N:function(t,e){c([t],t=>!i(t)&&(JigControl.M(()=>{if(void 0!==t.$owner&&t.$owner!==e){const e="Hint: Consider storing a clone of the value instead.";throw new Error(`${s(t)} belongs to a different resource\n\n${e}`)}}),!0))},C:c,B:function(t,e,n=new Set){"function"!=typeof t&&"object"!=typeof t||!t||function t(e,n,o){if(!e)return;if(o.has(e))return;o.add(e);const i=e=>{if("function"!=typeof e&&"object"!=typeof e||!e)return e;const r=n(e);return t(r,n,o),r},s=r(4)._,c=s.O,a=s.P;if(e instanceof c.Set||e instanceof a.Set){const t=[],r=[];for(const n of e){const o=i(n);o!==n&&(t.push(n),r.push(o)),t.forEach(t=>e.delete(t)),r.forEach(t=>e.add(t))}}if(e instanceof c.Map||e instanceof a.Map){const t=[],r=[];for(const[n,o]of e){const e=i(n),s=i(o);e!==n&&t.push(n),e===n&&s===o||r.push([e,s])}t.forEach(t=>{e.delete(t)}),r.forEach(([t,r])=>e.set(t,r))}Object.keys(e).forEach(t=>{e[t]=i(e[t])})}(t,e,n)},D:function(t){if("number"!=typeof t)throw new Error("satoshis must be a number");if(!Number.isInteger(t))throw new Error("satoshis must be an integer");if(isNaN(t)||!isFinite(t))throw new Error("satoshis must be finite");if(t<0)throw new Error("satoshis must be non-negative");if(t>1e8)throw new Error("satoshis must be <= 100000000")},L:function(t,e){if("string"==typeof t){try{const r=new n.PublicKey(t,{network:e});return new StandardLock(r.toAddress().toString())}catch(t){}try{return new n.Address(t,e),new StandardLock(t)}catch(t){}}const{Lock:o}=r(17);if(t instanceof o){const e=t.script(),n=r(4),o=n._.P,i=n._.O;if(e instanceof o.Uint8Array||e instanceof i.Uint8Array)return t}throw new Error("Invalid owner: "+s(t))},G:class{constructor(){this.tasks=[]}async enqueue(t){return new Promise((e,r)=>{this.tasks.push({func:t,reject:r,resolve:e}),1===this.tasks.length&&this.execNext()})}async execNext(){const t=this.tasks[0];try{const e=t.func();t.resolve(e instanceof Promise?await e:e)}catch(e){t.reject(e)}finally{this.tasks.shift(),this.tasks.length&&this.execNext()}}},H:function(t,e){const r=new n.Transaction(t),o=r.toObject(),i=[],s=[];r.inputs&&r.inputs.forEach((function(t,r){if(t.script){const o={i:r,seq:t.sequenceNumber};t.script.chunks.forEach((function(t,r){t.buf?(t.buf.byteLength>=1e6?o["xlb"+r]=t.buf.toString("base64"):t.buf.byteLength>=512&&t.buf.byteLength<1e6?o["lb"+r]=t.buf.toString("base64"):o["b"+r]=t.buf.toString("base64"),e&&e.h&&e.h>0&&(o["h"+r]=t.buf.toString("hex"))):void 0!==t.opcodenum?o["b"+r]={op:t.opcodenum}:o["b"+r]=t}));const s={h:t.prevTxId.toString("hex"),i:t.outputIndex},c=t.script.toAddress(n.Networks.livenet).toString();c&&c.length>0&&(s.a=c),o.e=s,i.push(o)}})),r.outputs&&r.outputs.forEach((function(t,r){if(t.script){const o={i:r};t.script.chunks.forEach((function(t,r){t.buf?(t.buf.byteLength>=1e6?(o["xlb"+r]=t.buf.toString("base64"),o["xls"+r]=t.buf.toString("utf8")):t.buf.byteLength>=512&&t.buf.byteLength<1e6?(o["lb"+r]=t.buf.toString("base64"),o["ls"+r]=t.buf.toString("utf8")):(o["b"+r]=t.buf.toString("base64"),o["s"+r]=t.buf.toString("utf8")),e&&e.h&&e.h>0&&(o["h"+r]=t.buf.toString("hex"))):void 0!==t.opcodenum?o["b"+r]={op:t.opcodenum}:o["b"+r]=t}));const i={v:t.satoshis,i:r},c=t.script.toAddress(n.Networks.livenet).toString();c&&c.length>0&&(i.a=c),o.e=i,s.push(o)}}));const c={tx:{h:o.hash},in:i,out:s,lock:o.nLockTime};return e&&e.confirmations&&(c.confirmations=e.confirmations),c},J:function(t){const e=r(5),n=r(4),o=[],i={V:n._.P,W:e.K.q(e.K.Y(t=>(o.push(t),o.length-1)),e.K.X()),Z:e.tt.q(e.tt.Y(t=>o[t]),e.tt.X())},s=e.et(t,i);return e.rt(s,i)},nt:function(t){const e=r(5),n=r(4),o=[],i={V:n._.ot,W:e.K.q(e.K.Y(t=>(o.push(t),o.length-1)),e.K.X()),Z:e.tt.q(e.tt.Y(t=>o[t]),e.tt.X())},s=e.et(t,i);return e.rt(s,i)}}},function(t,e){const r={};function n(t,e,...n){r.it&&r.it[t]&&"function"==typeof r.it[t]&&r.it[t]((new Date).toISOString(),`[${e}]`,...n)}r.st={warn:console.warn,error:console.error},r.it=r.st,r.ct=(...t)=>n("info",...t),r.at=(...t)=>n("warn",...t),r.ut=(...t)=>n("error",...t),r.ft=(...t)=>n("debug",...t),t.exports=r},function(t,e){t.exports=require("bsv")},function(t,e,r){const Context=r(15);class Jig{constructor(...t){const e=Context.A();if(!e.code.isSandboxed(this.constructor)){e.transaction.begin();try{return new(e.code.deploy(this.constructor))(...t)}finally{e.transaction.end()}}const r=[];let n=this.constructor;for(;n!==Jig;)r.push(n),n=Object.getPrototypeOf(n);if(0===r.length)throw new Error("Jig must be extended");const o=/\s+constructor\s*\(/;if(r.some(t=>o.test(t.toString())))throw new Error("Jig must use init() instead of constructor()");const i=["origin","location","owner","satoshis","sync"];r.forEach(t=>{i.forEach(t=>{if(Object.prototype.hasOwnProperty.call(r[0].prototype,t))throw new Error("must not override "+t)})});const s=[];[...r,Jig].forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(t=>s.push(t))});const c=[...s,"owner","satoshis","origin","location"];function a(){JigControl.lt=[],JigControl.ht=new Set,JigControl.pt=new Set,JigControl.yt=new Map,JigControl.gt=new Map,JigControl.dt=new Map,JigControl.ut=null}const u=()=>{if(JigControl.wt&&this.origin&&"!"===this.origin[0])throw new Error(""+this.origin.slice(1))},f=this,l={bt:f,_t:null,Pt:null},h=new Proxy(this,l),p=()=>JigControl.lt[JigControl.lt.length-1],y=()=>JigControl.lt.length&&p()===f,g=()=>JigControl.lt.length&&p().constructor!==h.constructor;let d=!!JigControl.Ot;return l.getPrototypeOf=function(t){return u(),JigControl.lt.length&&JigControl.dt.set(f,h),Object.getPrototypeOf(t)},l.setPrototypeOf=function(t,e){throw new Error("setPrototypeOf disallowed")},l.isExtensible=function(t){return!0},l.preventExtensions=function(t){throw new Error("preventExtensions disallowed")},l.getOwnPropertyDescriptor=function(t,e){if(u(),JigControl.lt.length&&JigControl.dt.set(f,h),!this.has(t,e))return;const r=Object.getOwnPropertyDescriptor(t,e);return r?Object.assign({},r,{value:this.get(t,e)}):void 0},l.defineProperty=function(t,e,r){throw new Error("defineProperty disallowed")},l.has=function(t,e){if(u(),JigControl.lt.length&&JigControl.dt.set(f,h),JigControl.wt&&"_"===e[0]&&g())throw new Error(`cannot check ${e} because it is private`);return JigControl.lt.length&&(!(t instanceof Jig)||!c.includes(e))&&JigControl.pt.add(f),e in t},l.get=function(t,e,r){if(u(),JigControl.lt.length&&JigControl.dt.set(f,h),JigControl.Et){if("$owner"===e)return h;if("$target"===e)return t}const n=t instanceof Jig;if(JigControl.wt&&n&&["origin","location"].includes(e)&&"_"===t[e][0])throw new Error("sync() required before reading "+e);if(n&&["origin","constructor"].includes(e))return t[e];const o=n&&"function"==typeof t[e];if(JigControl.lt.length&&!o&&JigControl.pt.add(f),"_"===e[0]&&g())throw new Error(`cannot get ${e} because it is private`);if(["undefined","boolean","number","string","symbol"].includes(typeof t[e]))return t[e];if(e===Symbol.iterator)return t instanceof Context.O.Uint8Array?t[e].bind(t):t[e].bind(r);if("object"==typeof t[e]){if(null===t[e])return null;if(Context.R(t[e]))return t[e];if(!JigControl.wt)return t[e];const r=JigControl.lt.length?t[e]:Context.J(t[e]);if("owner"===e&&n)return JigControl.lt.length&&!y()?Context.nt(t[e]):r;const o=JigControl.lt.length?this.bt:r,i=Object.assign({},this,{bt:o,_t:t,Pt:e});return JigControl.vt?new Proxy(r,i):r}if("constructor"===e)return t[e];if("function"==typeof t[e]){const r={_t:t,Pt:e},n=Object.assign({},this,r);return JigControl.vt?t[e].location?t[e]:new Proxy(t[e],n):t[e]}},l.set=function(t,e,r,n){if(u(),JigControl.lt.length&&JigControl.dt.set(f,h),JigControl.wt){if(!y())throw new Error(`must not set ${e} outside of a method`);if(t instanceof Jig){if(["origin","location",...s].includes(e))throw new Error("must not set "+e)}else{if("function"==typeof t[e])throw new Error("must not overwrite internal method "+e);if("function"==typeof t)throw new Error(`must not set ${e} on method ${t.name}`)}}return Context.N(r,h),t[e]=r,!0},l.deleteProperty=function(t,e){if(u(),JigControl.lt.length&&JigControl.dt.set(f,h),JigControl.wt){if(!y())throw new Error(`must not delete ${e} outside of a method`);if(t instanceof Jig){if(["origin","location","satoshis","owner",...s].includes(e))throw new Error("must not delete "+e)}else if("function"==typeof t[e])throw new Error("must not delete internal method "+e)}return delete t[e],!0},l.ownKeys=function(t){return u(),JigControl.lt.length&&JigControl.dt.set(f,h),JigControl.lt.length&&JigControl.pt.add(f),g()?Reflect.ownKeys(t).filter(t=>"_"!==t[0]):Reflect.ownKeys(t)},l.apply=function(t,e,r){const n=this._t instanceof Jig;if(n&&"_"===this.Pt[0]&&(!JigControl.lt.length||p().constructor!==h.constructor))throw new Error(`cannot call ${this.Pt} because it is private`);if(n&&"sync"===this.Pt){if(JigControl.lt.length)throw new Error("sync may only be called externally");return t.call(h,...r)}const o=Context.A();o.transaction.begin();let i=null;n||y()||(i=Object.assign({},JigControl),a());const s=JigControl.gt.get(f)||new Set;JigControl.lt.forEach(t=>s.add(t)),JigControl.gt.set(f,s),JigControl.lt.push(f),JigControl.dt.set(f,h);try{if(n&&"init"===this.Pt){if(d)throw new Error("init cannot be called twice");d=!0,JigControl.ht.add(f)}const e=new Set(JigControl.pt),s=n?new Context.Checkpoint(r,o.code):null;if(!JigControl.yt.has(this.bt)){const t=new Context.Checkpoint(Object.assign({},this.bt),o.code);JigControl.yt.set(this.bt,t)}JigControl.pt=e;const c=n?s.restore():r,u=t.call(n?h:this._t,...c);if(n&&"init"===this.Pt&&void 0!==u)throw new Error("init must not return");if(n&&(Context.L(f.owner),Context.D(f.satoshis)),JigControl.ut)throw new Error("internal errors must not be swallowed\n\n"+JigControl.ut);if(JigControl.lt.pop(),!JigControl.lt.length){const t=new Set(JigControl.pt),e=new Map,s=JigControl.g(()=>{const t=new Set(JigControl.pt);Array.from(JigControl.yt.keys()).forEach(e=>t.add(e)),t.forEach(t=>{e.set(t,new Context.Checkpoint(Object.assign({},t),o.code))});return Array.from(JigControl.yt).filter(([t,r])=>!r.equals(e.get(t))).map(([t])=>t)});JigControl.pt=t;const c=!n&&!JigControl.wt;if((JigControl.ht.size||s.length)&&!c){if(!n)throw new Error(`internal method ${this.Pt} may not be called to change state`);const t=new Set,i=new Set,c=new Set(JigControl.pt),a=e=>{i.add(e),JigControl.ht.has(e)||t.add(e)};s.forEach(t=>{JigControl.gt.get(t).forEach(t=>a(t)),a(t)}),JigControl.ht.forEach(t=>{JigControl.gt.get(t).forEach(t=>a(t)),a(t)}),o.transaction.St(f,this.Pt,r,t,i,c,JigControl.yt,e,JigControl.dt)}i?(JigControl.ht.forEach(t=>i.ht.add(t)),JigControl.pt.forEach(t=>i.pt.add(t)),JigControl.yt.forEach((t,e)=>{JigControl.yt.has(e)||i.yt.set(e,t)}),JigControl.dt.forEach((t,e)=>{JigControl.dt.has(e)||i.dt.set(e,t)}),JigControl.gt.forEach((t,e)=>{if(i.gt.has(e)){const r=i.gt.get(e);t.forEach(t=>r.add(t))}else i.gt.set(e,t)}),Object.assign(JigControl,i)):a()}o.transaction.end();try{return JigControl.lt.length?u:Context.J(u)}catch(t){return u}}catch(t){throw JigControl.ut||(JigControl.ut=t),i&&Object.assign(JigControl,i),JigControl.lt.pop(),JigControl.lt.length||(JigControl.yt.forEach((t,e)=>{const r=t.restore();JigControl.g(()=>{Object.keys(e).forEach(t=>delete e[t]),Object.assign(e,r)})}),a()),o.transaction.end(),t}},JigControl.Ot||(this.owner=JigControl.lt.length?JigControl.lt[JigControl.lt.length-1].owner:Context.At(),this.satoshis=0,this.origin="_",this.location="_",h.init(...t)),h}init(){}toString(){return`[jig ${this.constructor.name}]`}async sync(t={}){return Context.A().Tt.It.xt(this,t.forward)}static[Symbol.hasInstance](t){const e=Context.A();if("object"!=typeof t)return!1;if(t===t.constructor.prototype)return!1;let r=e.code.jt(this);if(!r){const t=Context.j(e.blockchain.network);if(r=e.code.jt(this["origin"+t]),!r)return!1}let n=Object.getPrototypeOf(t);for(;n;){if(n===r.prototype)return!0;n=Object.getPrototypeOf(n)}return!1}}const JigControl={lt:[],ht:new Set,pt:new Set,yt:new Map,gt:new Map,ut:null,wt:!0,vt:!0,Et:!1,dt:new Map,Ot:!1,$t:t=>{const e=JigControl.vt;try{return JigControl.vt=!1,t()}finally{JigControl.vt=e}},g:t=>{const e=JigControl.wt;try{return JigControl.wt=!1,t()}finally{JigControl.wt=e}},M:t=>{const e=JigControl.Et;try{return JigControl.Et=!0,t()}finally{JigControl.Et=e}},Rt:()=>JigControl.lt.length<2?null:JigControl.dt.get(JigControl.lt[JigControl.lt.length-2])},n={JigControl,Context,Set,Map};t.exports={Jig,JigControl,kt:n}},function(module,exports,__webpack_require__){const DeterministicRealm=__webpack_require__(25),{ResourceMap,ResourceSet}=__webpack_require__(8),{F:_display,U:_sourceCode}=__webpack_require__(0),Log=__webpack_require__(1),TAG="Sandbox";let instance=null;class Sandbox{static get _(){return instance||(instance=new Sandbox),instance}constructor(){Log.ct(TAG,"Creating deterministic realm"),this.Ft=new DeterministicRealm;const compartment=this.Ft.makeCompartment();this.O=compartment.evaluate(_getIntrinsicsSrc),this.O.Map=this.Ut(ResourceMap,ResourceMap.deps)[0],this.O.Set=this.Ut(ResourceSet,ResourceSet.deps)[0],this.P=eval(_getIntrinsicsSrc)}Ut(t,e){if(Sandbox.excludes.includes(t)){return Log.ct(TAG,"Excluding",_display(t)),[t,"undefined"!=typeof global?global:window]}return this.Nt(_sourceCode(t),e)}Nt(t,e={}){Log.ct(TAG,"Evaluating",_display(t.replace(/\s+/g," ")));const r=this.Ft.makeCompartment();Object.assign(r.global,this.O,e);const n=t.startsWith("class")?"AnonymousClass":"anonymousFunction",o=`const ${n}=${t};${n}`;return"Math"in e||Object.defineProperty(r.global,"Math",{get:()=>{throw new ReferenceError("Math is not defined\n\nHint: Math is disabled because it is non-deterministic.")}}),"Date"in e||Object.defineProperty(r.global,"Date",{get:()=>{throw new ReferenceError("Date is not defined\n\nHint: Date is disabled because it is non-deterministic.")}}),[r.evaluate(o),r.global]}}const _intrinsicNames=["console","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","Object","Function","Boolean","Symbol","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError","Number","BigInt","Math","Date","String","RegExp","Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array","Map","Set","WeakMap","WeakSet","ArrayBuffer","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"];let _getIntrinsicsSrc="const x = {}\n";_intrinsicNames.forEach(t=>{_getIntrinsicsSrc+=`x.${t} = typeof ${t} !== 'undefined' ? ${t} : undefined\n`}),_getIntrinsicsSrc+="x",Sandbox.excludes=[],module.exports=Sandbox},function(t,e,r){const{R:n,F:o}=r(0),{ResourceMap,ResourceSet:i}=r(8),s=r(4);class c{static et(t,e={}){(e=Object.assign({},e)).P=e.P||s._.P,e.ot=e.ot||s._.O,e.V=e.V||e.P,e.W=e.W||null,e.Mt||(e.Mt=new Set,Object.keys(e.P).forEach(t=>e.Mt.add(e.P[t])),e.P!==e.ot&&Object.keys(e.ot).forEach(t=>e.Mt.add(e.ot[t]))),e.Ct=e.Ct||new ResourceMap,e.Bt=e.Bt||new i;const r="boolean"!=typeof e.Dt||e.Dt;e.Dt=!1;const n=a(t,e);return e.Bt.size&&r?function(t,e){const r=l(e);r.$dedup={};const n=new Map;r.dups=h(e);for(const t of e.Bt){const o=l(e);o.$dup=r.dups.length,n.set(t,o),r.dups.push(t)}return r.$dedup=u(t,n),r.dups.forEach(t=>{Object.keys(t).forEach(e=>{t[e]=u(t[e],n)})}),r}(n,e):n}static rt(t,e={}){return(e=Object.assign({},e)).P=e.P||s._.P,e.ot=e.ot||s._.O,e.V=e.V||e.ot,e.Z=e.Z||null,f(t,e)}}function a(t,e){switch(typeof t){case"undefined":{const t=l(e);return t.$undef=1,t}case"string":case"boolean":return t;case"number":if(isNaN(t)||!isFinite(t)||Object.is(t,-0)){const r=l(e);return isNaN(t)&&(r.$nan=1),t===1/0&&(r.$inf=1),t===-1/0&&(r.$ninf=1),Object.is(t,-0)&&(r.$n0=1),r}return t;case"symbol":break;case"object":case"function":{if(!t)return null;const r=e.Ct.get(t);return r?(e.Bt.add(r),r):function(t,e){e.Mt.has(t)&&g(t);if(b(t)){const r=l(e);e.Ct.set(t,r);let n=!1;if(Object.keys(t).forEach(o=>{n=n||o.startsWith("$"),r[o]=a(t[o],e)}),!n)return r;const o=l(e);return o.$obj=r,o}if(_(t)){const r=Object.keys(t);if(r.length===t.length){const n=h(e);return e.Ct.set(t,n),r.forEach(r=>n.push(a(t[r],e))),n}{const n=l(e),o=l(e);return e.Ct.set(t,n),r.forEach(r=>{o[r]=a(t[r],e)}),n.$arr=o,n}}if((t instanceof e.P.Set||t instanceof e.ot.Set)&&3===w(t)){const r=l(e);e.Ct.set(t,r),r.$set=h(e);for(const n of t)r.$set.push(a(n,e));return Object.keys(t).length&&(r.props=l(e),Object.keys(t).forEach(n=>{r.props[n]=a(t[n],e)})),r}if((t instanceof e.P.Map||t instanceof e.ot.Map)&&3===w(t)){const r=l(e);e.Ct.set(t,r),r.$map=h(e);for(const[n,o]of t){const t=h(e);t.push(a(n,e)),t.push(a(o,e)),r.$map.push(t)}return Object.keys(t).length&&(r.props=l(e),Object.keys(t).forEach(n=>{r.props[n]=a(t[n],e)})),r}if((t instanceof e.P.Uint8Array||t instanceof e.ot.Uint8Array)&&4===w(t)){const r=Object.keys(t);r.length!==t.length&&g(t);const n=t=>Number.isInteger(t)&&t<=255&&t>=0;r.some(e=>!n(t[e]))&&g(t);const o=l(e);e.Ct.set(t,o);const i=Buffer.from(new Uint8Array(t));return o.$ui8a=i.toString("base64"),o}if(e.W){const r=e.W(t,e);if(r)return r}g(t)}(t,e)}}g(t)}function u(t,e){if("object"!=typeof t&&"function"!=typeof t||!t)return t;const r=e.get(t);return r||(Object.keys(t).forEach(r=>{t[r]=u(t[r],e)}),t)}function f(t,e){switch(typeof t){case"string":case"boolean":return t;case"number":if(isNaN(t)||!isFinite(t)||Object.is(t,-0))break;return t;case"object":case"function":return t?function(t,e){if(b(t)){let r;if(Object.keys(t).forEach(e=>{e.startsWith("$")&&(r&&d(t),r=e)}),!r){const r=e.Lt||l(e);return delete e.Lt,e.Gt?r:(Object.keys(t).forEach(n=>{r[n]=f(t[n],e)}),r)}if("$undef"===r&&1===t.$undef)return;if("$n0"===r&&1===t.$n0)return-0;if("$nan"===r&&1===t.$nan)return NaN;if("$inf"===r&&1===t.$inf)return 1/0;if("$ninf"===r&&1===t.$ninf)return-1/0;if("$arr"===r){b(t.$arr)&&t.$arr||d(t);const r=e.Lt||h(e);if(delete e.Lt,e.Gt)return r;const n=t.$arr;return Object.keys(n).forEach(t=>{r[t]=f(n[t],e)}),r}if("$obj"===r){b(t.$obj)&&t.$obj||d(t);const r=e.Lt||l(e);if(delete e.Lt,e.Gt)return r;const n=t.$obj;return Object.keys(n).forEach(t=>{r[t]=f(n[t],e)}),r}if("$set"===r){_(t.$set)||d(t),m(t.props)||b(t.props)||d(t);const r=e.Lt||p(e);if(delete e.Lt,e.Gt)return r;for(const n of t.$set)r.add(f(n,e));const n=t.props;return n&&Object.keys(n).forEach(t=>{r[t]=f(n[t],e)}),r}if("$map"===r){_(t.$map)||d(t),m(t.props)||b(t.props)||d(t);const r=e.Lt||y(e);if(delete e.Lt,e.Gt)return r;for(const n of t.$map)_(n)&&2===n.length||d(t),r.set(f(n[0],e),f(n[1],e));const n=t.props;return n&&Object.keys(n).forEach(t=>{r[t]=f(n[t],e)}),r}if("$ui8a"===r){"string"!=typeof t.$ui8a&&d(t),t.$ui8a.split("").some(t=>!P.has(t))&&d(t);const r=Buffer.from(t.$ui8a,"base64");return e.V.Uint8Array.from(r)}if("$dedup"===r){"object"==typeof t.$dedup&&t.$dedup||d(t),_(t.dups)||d(t),m(e.Bt)||d(t),e.Gt=!0,e.Bt=t.dups.map(t=>f(t,e)),delete e.Gt,t.dups.forEach((t,r)=>{e.Lt=e.Bt[r],f(t,e)});const r=f(t.$dedup,e);return delete e.Bt,r}if("$dup"===r)return _(e.Bt)||d(t),"number"==typeof t.$dup&&t.$dup>=0&&t.$dup<e.Bt.length||d(t),e.Bt[t.$dup]}if(_(t)){const r=e.Lt||h(e);if(delete e.Lt,e.Gt)return r;for(const n of t)r.push(f(n,e));return r}if(e.Z){const r=e.Z(t,e);if(delete e.Lt,r)return r}d(t)}(t,e):null}d(t)}const l=t=>new t.V.Object,h=t=>new t.V.Array,p=t=>new t.V.Set,y=t=>new t.V.Map,g=t=>{throw new Error("Cannot serialize "+o(t))},d=t=>{throw new Error("Cannot deserialize "+o(t))},w=t=>{if(!t)return 0;let e=0;do{e++,t=Object.getPrototypeOf(t)}while(t);return e},b=t=>t&&2===w(t),_=t=>Array.isArray(t)&&3===w(t),m=t=>void 0===t,P=new Set;"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("").forEach(t=>P.add(t));const O=(...t)=>(...e)=>{for(const r of t){const t=r(...e);if(t)return t}};c.K={Y:function(t){return(e,r)=>{if(n(e)){const n=l(r);return n.$ref=t(e),n}}},X:()=>(t,e)=>{if("object"==typeof t){const r={};return e.Ct.set(t,r),r.$arb=c.et(Object.assign({},t),e),r.T=c.et(t.constructor,e),r}},q:O,Ct:t=>(e,r)=>{const n=r.Ct.get(e);if(n)return n;const o=t(e,r);return o?(r.Ct.set(e,o),o):void 0}},c.tt={Y:function(t){return e=>{if(b(e)&&!m(e.$ref))return t(e.$ref)}},X:()=>(t,e)=>{if(b(t)&&!m(t.$arb)&&!m(t.T)){const r=e.Lt||l(e);if(delete e.Lt,e.Gt)return r;Object.assign(r,c.rt(t.$arb,e));const n=c.rt(t.T,e);return Object.setPrototypeOf(r,n.prototype),r}},q:O},c.Ht=function(t){const e=[];return function t(e,r){"object"!=typeof e&&"function"!=typeof e||!e||(r(e),Object.keys(e).forEach(n=>t(e[n],r)))}(t,t=>{t.$ref&&e.push(t.$ref)}),e},t.exports=c},function(t,e){class r{static parse(t){if("_"===t)return{};const e=e=>{throw new Error(`${e}: ${t}`)};if("string"!=typeof t&&e("Location must be a string"),t.length||e("Location must not be empty"),"!"===t[0])return{error:t.slice(1),location:t};const n=t.split("://");if(n.length>2&&e("Location must only have one protocol"),2===n.length)return Object.assign({},r.parse(n[0]),{innerLocation:n[1]});const o=t.split("_");o.length>2&&e("Location has an unexpected _ separator"),o.length<2&&e("Location requires a _ separator");const i={location:t};0!==o[0].length&&64!==o[0].length&&e("Location has an invalid txid length"),"?"===o[0][0]?i.tempTxid=o[0]:o[0].length&&(/^[a-fA-F0-9]*$/.test(o[0])||e("Location has invalid hex in its txid"),i.txid=o[0]);const s=o[1].slice(1),c=parseInt(s,10);switch(!isNaN(c)&&/^[0-9]*$/.test(s)||e("Location has an invalid index number"),o[1][0]){case"o":i.vout=c;break;case"i":i.vin=c;break;case"r":i.vref=c;break;default:e("Location has an invalid index category")}return i}static build(t){const e=e=>{throw new Error(`${e}: ${JSON.stringify(t)}`)};if("object"==typeof t&&t||e("Location object is invalid"),void 0!==t.innerLocation&&"string"!=typeof t.innerLocation&&e("Inner location must be a string"),void 0!==t.error&&"string"!=typeof t.error&&e("Error must be a string"),void 0!==t.error)return"!"+t.error;let r=t.location;if(!r){const n=""+(t.txid||t.tempTxid||"");let o=null,i=null;"number"==typeof t.vout?(o="o",i=t.vout):"number"==typeof t.vin?(o="i",i=t.vin):"number"==typeof t.vref?(o="r",i=t.vref):e("Location index unspecified"),(isNaN(i)||!isFinite(i)||!Number.isInteger(i)||i<0)&&e("Location index must be a non-negative integer"),r=`${n}_${o}${i}`}return t.innerLocation?`${r}://${t.innerLocation}`:r}}t.exports=r},function(t,e,r){const n=r(2);function o(t){const{Hash:e}=n.crypto;return t._hash=t._hash||e.sha256(t.toBuffer()).reverse().toString("hex"),t._hash}t.exports={Jt:async function(t,e){for(let r=0;r<t.inputs.length;r++){const o=t.inputs[r];if(!o.output){const t=o.prevTxId.toString("hex"),r=await e.fetch(t);o.output=r.outputs[o.outputIndex],o.output.script.isPublicKeyHashOut()&&Reflect.setPrototypeOf(o,n.Transaction.Input.PublicKeyHash.prototype)}}},Vt:o,Wt:function(t){const{Script:e,Transaction:r}=t,{Interpreter:n}=e,{Input:i}=r,{ECDSA:s,Hash:c,Signature:a}=t.crypto,{BufferReader:u,BufferWriter:f}=t.encoding,{_:l}=t.deps;r.FEE_PER_KB=500;const h=r.prototype.sign;function p(...t){Object.assign(this,new r(t[0]))}r.prototype.sign=function(...t){const e=i.prototype.isValidSignature;i.prototype.isValidSignature=()=>!0;const r=h.call(this,...t);return i.prototype.isValidSignature=e,r},p.prototype=Object.create(r.prototype),Object.defineProperty(p.prototype,"hash",{configurable:!1,enumerable:!0,get:function(){return this._hash=this._hash||new u(this._getHash()).readReverse().toString("hex"),this._hash}}),r.prototype.lock=function(){return delete this._hash,Object.setPrototypeOf(this,p.prototype)},Object.defineProperty(e.prototype,"hash",{configurable:!1,enumerable:!0,get:()=>o(this)}),i.prototype.clearSignatures=()=>{},i.prototype.getSignatures=()=>[],i.prototype.isFullySigned=()=>!0,r.prototype.isFullySigned=function(){return l.every(l.map(this.inputs,t=>t.isFullySigned()))},r.prototype.isValidSignature=function(t){const e=new n,r=t.inputIndex,o=this.inputs[r],i=n.SCRIPT_VERIFY_STRICTENC|n.SCRIPT_VERIFY_DERSIG|n.SCRIPT_VERIFY_LOW_S|n.SCRIPT_VERIFY_NULLDUMMY|n.SCRIPT_VERIFY_SIGPUSHONLY|n.SCRIPT_ENABLE_MONOLITH_OPCODES|n.SCRIPT_ENABLE_MAGNETIC_OPCODES|n.SCRIPT_ENABLE_SIGHASH_FORKID;return e.verify(o.script,o.output.script,this,r,i,o.output.satoshisBN)},r.prototype.signature=function(t,e,r=a.SIGHASH_ALL){r|=a.SIGHASH_FORKID;const o=this.inputs[t].output.script,i=this.inputs[t].output.satoshisBN,h=(n.SCRIPT_ENABLE_SIGHASH_FORKID,function(t,e,r,n,o){const i=t.inputs[r];function s(e){const r=new f;if(l.isUndefined(e)){if(t._hashOutputsAll)return t._hashOutputsAll;l.each(t.outputs,(function(t){t.toBufferWriter(r)}))}else t.outputs[e].toBufferWriter(r);const n=r.toBuffer(),o=c.sha256sha256(n);return l.isUndefined(e)&&(t._hashOutputsAll=o),o}let h=Buffer.alloc(32),p=Buffer.alloc(32),y=Buffer.alloc(32);e&a.SIGHASH_ANYONECANPAY||(h=function(){if(t._hashPrevouts)return t._hashPrevouts;const e=new f;l.each(t.inputs,(function(t){e.writeReverse(t.prevTxId),e.writeUInt32LE(t.outputIndex)}));const r=e.toBuffer();return t._hashPrevouts=c.sha256sha256(r),t._hashPrevouts}()),e&a.SIGHASH_ANYONECANPAY||(31&e)===a.SIGHASH_SINGLE||(31&e)===a.SIGHASH_NONE||(p=function(){if(t._hashSequence)return t._hashSequence;const e=new f;l.each(t.inputs,(function(t){e.writeUInt32LE(t.sequenceNumber)}));const r=e.toBuffer();return t._hashSequence=c.sha256sha256(r),t._hashSequence}()),(31&e)!==a.SIGHASH_SINGLE&&(31&e)!==a.SIGHASH_NONE?y=s():(31&e)===a.SIGHASH_SINGLE&&r<t.outputs.length&&(y=s(r));const g=new f;g.writeInt32LE(t.version),g.write(h),g.write(p),g.writeReverse(i.prevTxId),g.writeUInt32LE(i.outputIndex),g.writeVarintNum(n.toBuffer().length),g.write(n.toBuffer()),g.writeUInt64LEBN(o),g.writeUInt32LE(i.sequenceNumber),g.write(y),g.writeUInt32LE(t.nLockTime),g.writeUInt32LE(e>>>0);const d=g.toBuffer(),w=c.sha256sha256(d);return new u(w).readReverse()}(this,r,t,o,i)),p=s.sign(h,e,"little"),y=Buffer.from(p.toDER());return Buffer.concat([y,Buffer.from([255&r])])}}}},function(t,e,r){const n=r(6),{JigControl}=r(3),{R:o}=r(0);class ResourceMap{constructor(t){const e=internal(this);if(e.Kt=new Map,e.Yt=new Map,e.zt=new Set,t)for(const[e,r]of t)this.set(e,r)}clear(){const t=internal(this);t.Kt.clear(),t.Yt.clear(),t.zt.clear()}delete(t){const e=internal(this),r=uniqueKey(e,t);return e.zt.delete(r),e.Yt.delete(r),e.Kt.delete(r)}get(t){return internal(this).Kt.get(uniqueKey(internal(this),t))}set(t,e){return internal(this).Kt.set(uniqueKey(internal(this),t),e),this}has(t){return internal(this).Kt.has(uniqueKey(internal(this),t))}get size(){return internal(this).Kt.size}get[Symbol.species](){return ResourceMap}entries(){return internal(this).Kt.entries()}keys(){return internal(this).Kt.keys()}forEach(t,e){return internal(this).Kt.forEach(t,e)}values(){return internal(this).Kt.values()}[Symbol.iterator](){return internal(this).Kt[Symbol.iterator]()}}ResourceMap.deps={internal,uniqueKey};class i{constructor(t){if(internal(this).map=new ResourceMap,t)for(const e of t)this.add(e)}get size(){return internal(this).map.size}get[Symbol.species](){return i}add(t){return internal(this).map.set(t,t),this}clear(){internal(this).map.clear()}delete(t){return internal(this).map.delete(t)}entries(){return internal(this).map.entries()}forEach(t,e){return internal(this).map.forEach(r=>t.call(e,r))}has(t){return internal(this).map.has(t)}values(){return internal(this).map.values()}[Symbol.iterator](){return internal(this).map.keys()}}i.deps={internal,ResourceMap};const s=t=>JigControl.g(()=>t.origin||t.location),c=t=>JigControl.g(()=>t.location);let a=!1;function uniqueKey(t,e){if(!e||!o(e))return e;const r=()=>{if(a)return;throw new Error("Inconsistent worldview\n\nFound two resources with the same origin at different locations.\n\nHint: Try syncing the relevant resources before use.")};if(!(t=>{try{return!!n.parse(s(t)).txid}catch(t){return!1}})(e))return t.zt.add(e),e;const i=s(e),u=c(e);for(const e of t.zt)if(i===s(e)){return u!==c(e)&&r(),t.zt.delete(e),t.Yt.set(i,e),e}const f=t.Yt.get(i);if(f){return u!==c(f)&&r(),f}return t.Yt.set(i,e),e}const u=new WeakMap;function internal(t){const e=JigControl.M(()=>t.$target||t);return u.has(e)||u.set(e,{}),u.get(e)}t.exports={ResourceMap,ResourceSet:i,Qt:function(t){const e=a;a=!0;try{t()}finally{a=e}}}},function(t,e){function r(t){if(!(t.outputs.length&&t.outputs[0].script.isSafeDataOut()&&7===t.outputs[0].script.chunks.length&&"run"===t.outputs[0].script.chunks[2].buf.toString("utf8")))throw new Error("not a run tx: "+t.hash);const e=t.outputs[0].script.chunks[3].buf;if(!(1===e.length&&2===e[0])){const r="Hint: Are you trying to load jigs created by a different version of run? This is not possible in the private alpha, sorry.",n=`Txid: ${t.hash}\nProtocol: ${e.toString("hex")}`;throw new Error(`Unsupported run protocol\n\n${n}\n\n${r}`)}}const n=" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`1234567890-=~!@#$%^&*()_+,./;'[]\\<>?:\"{}|".split(""),o="t08sY]m'#$Dy1`}pCKrHG)f9[uq%3\\ha=!ZVMkJ-*L\"xz67R? W~@wdO:Ecg|ITe52.+{ovBj>(&,/Q4lA;^<NPnXSFi_Ub".split("");function i(t){const e=t.split("").map(t=>-1!==o.indexOf(t)?n[o.indexOf(t)]:t).join("");try{return JSON.parse(e)}catch(t){throw new Error(`unable to parse decrypted run data\n\n${t.toString()}\n\n${e}`)}}t.exports={PROTOCOL_VERSION:2,Xt:r,Zt:function(t){return r(t),i(t.outputs[0].script.chunks[5].buf.toString("utf8"))},te:function(t,e){try{r(t)}catch(t){return"other"}if(0===e)return"rundata";const n=t.outputs[0].script.chunks[5].buf.toString("utf8");try{const t=i(n);if(e>=1&&e<1+t.code.length)return"code";if(e>=1+t.code.length&&e<1+t.code.length+t.jigs)return"jig"}catch(t){}return"other"},ee:function(t){return JSON.stringify(t).split("").map(t=>-1!==n.indexOf(t)?o[n.indexOf(t)]:t).join("")},re:i}},function(t,e,r){const Context=r(15);class Berry{constructor(...t){const e=Context.A();if(!e.code.isSandboxed(this.constructor)){e.transaction.begin();try{return new(e.code.deploy(this.constructor))(...t)}finally{e.transaction.end()}}const r=[];let n=this.constructor;for(;n!==Berry;)r.push(n),n=Object.getPrototypeOf(n);if(0===r.length)throw new Error("Berry must be extended");const o=/\s+constructor\s*\(/;if(r.some(t=>o.test(t.toString())))throw new Error("Berry must use init() instead of constructor()");if(!BerryControl.ne||BerryControl.ne!==this.constructor)throw new Error("Must only create Berry from its own plucker");if(this.init(...t),void 0!==this.location)throw new Error("Berry init() must not set a location");if(!BerryControl.location)throw new Error("Must only pluck one berry at a time");this.location=BerryControl.location,BerryControl.location=void 0,Context.deepFreeze(this)}init(){}static[Symbol.hasInstance](t){const e=Context.A();if("object"!=typeof t)return!1;if(t===t.constructor.prototype)return!1;let r=e.code.jt(this);if(!r){const t=Context.j(e.blockchain.network);if(r=e.code.jt(this["origin"+t]),!r)return!1}let n=Object.getPrototypeOf(t);for(;n;){if(n===r.prototype)return!0;n=Object.getPrototypeOf(n)}return!1}}const BerryControl={ne:void 0,location:void 0};const n={BerryControl,Context};t.exports={Berry,BerryControl,oe:n,ie:async function t(e,n,o,i){const{H:s}=r(0),c=r(6),a=async t=>s(await n.fetch(t)),u=e=>t(e,n,o,i),f=BerryControl.ne,l=BerryControl.location;try{const t=o.se(i);BerryControl.ne=t,c.parse(t.location).error?BerryControl.location=c.build({error:i.name+" not deployed"}):BerryControl.location=c.build({location:t.location,innerLocation:e});const r=await t.pluck(e,a,u,t);if(!r)throw new Error(`Failed to load berry using ${i.name}: ${e}`);if(!(r instanceof Berry))throw new Error("Plucker must return an instance of Berry");return r}finally{BerryControl.ne=f,BerryControl.location=l}}}},function(t,e){class NotImplementedError extends Error{constructor(t){super(t),this.name=this.constructor.name}}class TimeoutError extends Error{constructor(t){super(t),this.name=this.constructor.name}}t.exports={NotImplementedError,TimeoutError}},function(t,e,r){const n=r(1),{TimeoutError}=r(11);class o{static async ce(t,e=2e3){return o.ae(t,"GET",void 0,e)}static async ue(t,e,r=2e3){return o.ae(t,"POST",e,r)}static async ae(t,e,r,o){n.ct("REST",e,t);let s=null;try{s=await i(t,e,r,o)}catch(r){throw r.message+=`\n\n${e} ${t}`,r}const{data:c,status:a,statusText:u}=s;if(a>=200&&a<300)return c;const f=c.message?c.message.message||c.message:c,l=c.name&&f?`${c.name}: ${f}`:c.name||f;throw new Error(`${a} ${u}\n\n${e} ${t}\n\n${l}`)}}let i=null;i=async function(t,e,n,o){return new Promise((i,s)=>{const c=t.startsWith("http://")?r(33):r(34),a=r(35),u={accept:"application/json","accept-encoding":"gzip"};n&&(u["content-type"]="application/json");const f={method:e,headers:u,timeout:o};function l(t,e){t.headers["content-type"].includes("application/json")&&(e=JSON.parse(e)),i({data:e,status:t.statusCode,statusText:t.statusMessage})}const h=c.request(t,f,(function(t){let e=Buffer.alloc(0);t.on("data",t=>{e=Buffer.concat([e,t])}),t.on("end",()=>{"gzip"===t.headers["content-encoding"]?a.gunzip(e,(function(e,r){if(e)return s(e);l(t,r.toString())})):l(t,e.toString())})}));n&&h.write(JSON.stringify(n)),h.on("error",t=>s(t)),h.on("timeout",()=>{h.abort(),s(new TimeoutError(`Request timed out after ${o}ms`))}),h.end()})},t.exports=o},function(t,e){function hex(t){if("string"!=typeof t||t.length%2!=0)throw new Error("Bad hex: "+t);t=t.toLowerCase();const e="0123456789abcdef".split(""),r=[];for(let n=0;n<t.length;n+=2){const o=e.indexOf(t[n]),i=e.indexOf(t[n+1]);if(-1===o||-1===i)throw new Error("Bad hex: "+t);r.push(16*o+i)}return r}hex.originMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o2",hex.locationMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o2",hex.ownerMainnet="1CscRyquNBh5UAVYhfxvy1HfnQrSLe85MG",hex.originTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o2",hex.locationTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o2",hex.ownerTestnet="mqvDyKXEfdbUYTepHbi3vvtCxRrGVDgGcb",t.exports=hex},function(t,e,r){const n=r(2),o=r(22),{Wt:i}=r(7);!function(){if(process&&process.version){if(Number(process.version.match(/^v(\d+\.\d+)/)[1])<10)throw new Error("Run is supported only on Node v10 and above")}if("undefined"!=typeof window){const t=window.navigator.userAgent;if(-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident"))throw new Error("Run is not supported on Internet Explorer. Please upgrade to Edge.")}}(),global.Jig=o.Jig,global.Berry=o.Berry,global.Token=o.Token,i(n),t.exports=o},function(t,e,r){t.exports=class{static A(){return r(0).A()}static j(t){return r(0).j(t)}static D(t){return r(0).D(t)}static R(t){return r(0).R(t)}static J(t){return r(0).J(t)}static nt(t){return r(0).nt(t)}static At(){return this.A().transaction.fe()}static L(t){const{A:e,I:n,L:o}=r(0);return o(t,n(e().blockchain.network))}static N(...t){return r(0).N(...t)}static get Checkpoint(){return r(18)}static get O(){return r(4)._.O}static deepFreeze(t){Object.freeze(t)}}},function(t,e){class StandardLock{constructor(t){this.address=t}script(){if("string"!=typeof this.address)throw new Error("Address is not a string: "+this.address);const t=[],e=[];let r,n,o;const i=this.address;for(let s=0;s<i.length;s++){if(r=0,n="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz".indexOf(i[s]),n<0)throw new Error(`Invalid character in address: ${i}\n\nDetails: i=${s}, c=${i[s]}`);for(n||e.length^s||e.push(0);r in t||n;)o=t[r],o=o?58*o+n:n,n=o>>8,t[r]=o%256,r++}for(;r--;)e.push(t[r]);if(e.length<6)throw new Error("Address too short: "+i);if(0!==e[0]&&111!==e[0])throw new Error("Address may only be a P2PKH type: "+i);const s=[118,169,20,...e.slice(1,e.length-4),136,172];return new Uint8Array(s)}domain(){return 108}}StandardLock.locationMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o5",StandardLock.originMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o5",StandardLock.ownerMainnet="1CscRyquNBh5UAVYhfxvy1HfnQrSLe85MG",StandardLock.locationTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o5",StandardLock.originTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o5",StandardLock.ownerTestnet="mqvDyKXEfdbUYTepHbi3vvtCxRrGVDgGcb",StandardLock.toString(),t.exports=StandardLock},function(t,e,r){const n=r(4),{NotImplementedError}=r(11);class o{get network(){throw new NotImplementedError}async broadcast(t){throw new NotImplementedError}async fetch(t,e){throw new NotImplementedError}async utxos(t){throw new NotImplementedError}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&(!!t&&("function"==typeof t.broadcast&&("function"==typeof t.fetch&&("function"==typeof t.utxos&&"string"==typeof t.network))))}}class i{async pay(t){throw new NotImplementedError}async broadcast(t){throw new NotImplementedError}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&(!!t&&"function"==typeof t.pay)}}class s{async sign(t,e){throw new NotImplementedError}owner(){throw new NotImplementedError}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&(!!t&&("function"==typeof t.sign&&"function"==typeof t.owner))}}class c{info(...t){}debug(...t){}warn(...t){}error(...t){}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&!!t}}class a{async get(t){throw new NotImplementedError}async set(t,e){throw new NotImplementedError}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&(!!t&&("function"==typeof t.get&&"function"==typeof t.set))}}class u{script(){throw new NotImplementedError}domain(){throw new NotImplementedError}static[Symbol.hasInstance](t){if("object"!=typeof t||!t)return!1;if("function"!=typeof t.constructor.prototype.script)return!1;if(Object.getOwnPropertyNames(t).includes("script"))return!1;const e=t.script(),r=n._.O.Uint8Array;if(!(e instanceof Uint8Array||e instanceof r))return!1;const o=t.constructor.prototype.domain;if("function"!=typeof o)return!1;if(Object.getOwnPropertyNames(t).includes("domain"))return!1;if(o){if(!Number.isSafeInteger(t.domain()))return!1;if(t.domain()<0)return!1}return!0}}t.exports={Blockchain:o,Purse:i,Logger:c,State:a,Lock:u,Owner:s}},function(t,e,r){const n=r(5),{JigControl}=r(3),{R:o}=r(0);t.exports=class{constructor(t,e,r){this.le=[],this.he={W:n.K.q(n.K.Y(t=>(this.le.push(t),this.le.length-1)),n.K.X()),Z:n.tt.q(n.tt.Y(t=>this.le[t]),n.tt.X())},JigControl.g(()=>{JigControl.$t(()=>{this.pe=n.et(t,this.he)})}),this.le.forEach(t=>{"code"===o(t)&&e.deploy(t)})}restore(){return this.ye=this.ye||n.rt(this.pe,this.he),this.ye}equals(t){const e=(t,r)=>typeof t==typeof r&&("object"==typeof t&&"object"==typeof r?null===t&&null===r||null!==t&&null!==r&&(Object.keys(t).length===Object.keys(r).length&&Object.keys(t).every(n=>e(t[n],r[n]))):t===r);return!!e(this.pe,t.pe)&&(this.le.length===t.le.length&&this.le.every((e,r)=>this.le[r]===t.le[r]))}}},function(t,e,r){const n=r(2),{JigControl}=r(3),o=r(5),{Jt:i}=r(7),{ResourceSet:s}=r(8),c=r(1),a=r(6),{I:u,j:f,R:l,k:h,F:p,U:y,B:g,L:d}=r(0),{PROTOCOL_VERSION:w,Zt:b,ee:_}=r(9);t.exports=class{constructor(t){this.ge=t,this.de()}de(){this.we=[],this.be=[],this.yt=new Map,this._e=new Map,this.me=[],this.Pe=[],this.pt=new Set,this.dt=new Map,this.Oe=new Map,this.Ee=0,this.ve=!1,this.Se=!1,this.Ae=!1,this.xe=null}Ie(){return!this.we.length&&(!this.be.length&&!this.Ee)}async Te(t,e,r,s,a,h){if(!this.Ie())throw new Error("Cannot import: Transaction already in progress");i(t,e.je),this.ve=!0,this.Ee=1;const p=b(t),y=u(e.je.network);let w=1;const _=[];for(const r of p.code){const n=`${t.hash}_o${w++}`,o=await e.we.$e(r,n,t,e,y,h);_.push(o)}if(a&&a>0&&a<1+p.code.length)return void(this.we=new Array(p.code.length));const m=new Map;p.refs&&p.refs.forEach(t=>m.set(t,t));for(const e of p.actions){const r=e=>{if("_"!==e[0]&&m.set(e,e),"i"===e[1]){const r=t.inputs[parseInt(e.slice(2))];m.set(e,`${r.prevTxId.toString("hex")}_o${r.outputIndex}`)}};e.target&&"init"!==e.method&&r(e.target),o.Ht(e.args).forEach(t=>r(t))}for(const[,r]of m){const n=await e.je.fetch(r.slice(0,64)),o=parseInt(r.slice(66));if(void 0===n.outputs[o].spentTxId)throw new Error("Cannot check if read is stale. Blockchain API does not support spentTxId.");if(null===n.outputs[o].spentTxId)continue;const i=await e.je.fetch(n.outputs[o].spentTxId);if(i.time<=t.time&&i.time>=n.time&&t.time-n.time>72e5&&t.hash!==i.hash)throw new Error(r+" is stale. Aborting.")}for(const[t,n]of m)if(r&&n===r.location)m.set(t,r);else try{m.set(t,await e.Re.load(n))}catch(e){throw c.ut("Record",e),new Error(`Error loading ref ${t} at ${n}\n\n${e}`)}r&&m.set(r.location,r);const P=t=>{const e=e=>{if("jig"===l(e)&&e!==t){return Array.from(m.values()).find(t=>t.origin===e.origin)||e}return e};JigControl.g(()=>g(t,e))};for(const t of m.values())P(t);for(const r of p.actions){const n=t=>JigControl.g(()=>{if("_"!==t[0]||"i"===t[1]){const e=m.get(t);if(!e)throw new Error("Unexpected ref "+t);return e}if("r"===t[1]){const e=m.get(p.refs[parseInt(t.slice(2))]);if(!e)throw new Error("Unexpected ref "+t);return e}if("o"!==t[1])throw new Error("Unexpected ref "+t);const e=parseInt(t.slice(2))-1;return e<p.code.length?_[e]:this.dt.get(this.Pe[e-p.code.length])}),i={ot:e.we.ot,Z:o.tt.q(o.tt.Y(n),o.tt.X())},s=o.rt(r.args,i);if("init"===r.method){if("_"===r.target[0]){const t=parseInt(r.target.slice(2));if(t<=0||t>=p.code.length+1)throw new Error("missing target "+r.target)}const n="_"===r.target[0]?t.hash+r.target:r.target,c=await e.Re.load(n),a=o.rt(r.creator,i);e.Re.ke(this,a);try{new c(...s)}finally{e.Re.Fe()}}else{const t=m.get(r.target)||this.dt.get(this.Pe[parseInt(r.target.slice(2))-1-p.code.length]);if(P(t),void 0===t)throw new Error(`target ${r.target} missing`);e.Re.ke(this,null);try{t[r.method](...s)}catch(t){throw new Error(`unexpected exception in ${r.method}\n\n${t}`)}finally{e.Re.Fe()}}}const O=this.me.filter(t=>"_"!==t.origin[0]);if(p.jigs!==this.Pe.length)throw new Error(`bad number of jigs: ${p.jigs} != ${this.Pe.length}`);if(t.inputs.length<O.length)throw new Error("not enough inputs");if(t.outputs.length<p.code.length+p.jigs+1)throw new Error("not enough outputs");O.forEach((e,r)=>{if(`${t.inputs[r].prevTxId.toString("hex")}_o${t.inputs[r].outputIndex}`!==(this.Oe.get(e.origin)||e.location))throw new Error("bad input "+r)}),this.Pe.forEach((e,r)=>{const o=1+p.code.length+r;if(Buffer.from(d(e.owner,y).script()).toString("hex")!==t.outputs[o].script.toHex())throw new Error("Owner mismatch on output "+o);if(t.outputs[o].satoshis<Math.max(e.satoshis,n.Transaction.DUST_AMOUNT))throw new Error("bad satoshis on output "+o)}),s&&this.Pe.forEach(e=>{const r=`${t.hash}_o${1+p.code.length+parseInt(e.location.slice(2))}`;"_"===e.origin[0]&&(e.origin=r),"_"===e.location[0]&&(e.location=r)});const E=this.Pe.map(t=>this.dt.get(t)),v=new Array(1+p.code.length).concat(E),S=f(e.je.network);for(let r=0;r<v.length;r++){if(!v[r])continue;const n=`${t.hash.slice(0,64)}_o${r}`,i=JigControl.g(()=>{const n=Object.assign({},v[r]);(n.origin.startsWith(t.hash)||n.origin.startsWith("_"))&&delete n.origin,(n.location.startsWith(t.hash)||n.location.startsWith("_"))&&delete n.location;return o.et(n,{ot:e.we.ot,W:o.K.Ct(o.K.q(o.K.Y(e=>e.location.startsWith(t.hash)?e.location.slice(64):e.location),o.K.X()))})});let s=v[r].constructor["origin"+S];s.startsWith(t.hash)&&(s=s.slice(64));const c={type:s,state:i};await e.Ue.set(n,c)}this.we=[],p.code.forEach((r,n)=>{const o=`${t.hash}_o${n+1}`,i=e.we.jt(o),s=e.we.extractProps(i).props,c=i.owner;this.Ne(i,i,{},s,()=>{},()=>{},c,e.we,e)});const A=O.map(t=>this.Oe.get(t.origin)||t.location);this.xe={tx:t,refs:p.refs||[],Me:O,Ce:A};for(let r=0;r<this.we.length;r++)if(null===t.outputs[r+1].spentTxId){const t=this.we[r].S;e.De.Be(t)}for(let r=0;r<this.Pe.length;r++)if(null===t.outputs[r+1+this.we.length].spentTxId){const t=this.Pe[r],n=this.dt.get(t);e.De.Be(n)}this.ve=!1,this.Se=!0,this.Ae=!0}Le(){this.Ee++}Ge(){if(0===this.Ee)throw new Error("end transaction without begin");0==--this.Ee&&this.ge&&!this.Ie()&&this.ge()}He(t,e,r,n){delete this.xe,this.we.forEach(t=>t.error()),this.we.forEach(t=>e.De.Be(t.S)),this.Pe.forEach(e=>{if("_"===e.origin[0]||n){const t=`!${"_"===e.origin[0]?"Deploy failed":"A previous update failed"}\n\n${r}`;return Object.keys(e).forEach(t=>delete e[t]),void(e.origin=e.location=t)}if("_"!==e.location[0])return;const o=e.origin,i=this.yt.get(e).restore();JigControl.g(()=>{Object.keys(e).forEach(t=>delete e[t]),Object.assign(e,i),e.origin=o,e.location||(e.location=t.get(o))})}),this.Pe.forEach(t=>e.De.Be(t)),this.de()}Ne(t,e,r,n,o,i,s,c,a){delete this.xe,this.Se=!1,this.Ae=!1,this.Le();try{"object"==typeof s&&a.Je(s.constructor),this.we.push({T:t,S:e,deps:r,props:n,success:o,error:i,owner:s});const c="_d"+(this.we.length-1);return t.owner=e.owner=s,this.ve||a.De.Be(e),c}finally{this.Ge()}}St(t,e,r,n,o,i,c,a,u,f){delete this.xe,this.Se=!1,this.Ae=!1,this.Le();try{const f=new s([t]);n.forEach(t=>f.add(t)),o.forEach(t=>f.add(t)),i.forEach(t=>f.add(t)),c.forEach((t,e)=>{this.yt.set(e,this.yt.get(e)||t)}),a.forEach((t,e)=>{this._e.set(e,t)}),n.forEach(t=>{const r=e=>h(t,e)&&e.location!==t.location;if(this.me.some(r)){const n=this.me.find(r),o=this.yt.get(n).pe.location,i=`${"origin: "+t.origin}\n${"1st location (after update): "+n.location}\n${"1st location (before update): "+o}\n${"2nd location: "+t.location}`,s=o===t.location?"Hint: Multiple dfferent up-to-date instances of this jig were found. Try updating without the batch.":"Hint: Try syncing all instances of this jig before calling "+e;throw new Error(`${`Different location for ${n} found in ${e}()`}\n\n${i}\n\n${s}`)}this.me.some(e=>h(t,e))||this.me.push(t)}),o.forEach(t=>{const e=this.Pe.findIndex(e=>h(t,e));if(-1!==e)return t.location="_o"+e,void(t.origin=t.origin||t.location);this.Pe.push(t);(t=>t.origin&&"_"!==t.origin[0]&&t.location&&"_"!==t.location[0]&&!this.Oe.has(t.origin))(t)&&this.Oe.set(t.origin,t.location),t.location="_o"+(this.Pe.length-1),t.origin=t.origin||t.location}),i.forEach(t=>this.pt.add(t)),u.forEach((t,e)=>this.dt.set(e,t));const l=c.get(t).restore().owner;this.be.push({target:t,method:e,creator:l,args:r,inputs:n,outputs:o,reads:i})}finally{this.Ge()}this.ve||o.forEach(t=>f.De.Be(u.get(t)))}async Ve(t){this.xe||this.We(t),this.qe(this.xe.tx);const e=this.xe.tx.toString("hex"),r=await t.Ke.pay(e);this.xe.tx=new n.Transaction(r),this.Ye(this.xe.tx),await i(this.xe.tx,t.je),this.Se=!0}qe(t){if(this.Ae)return;const e=this.me.filter(t=>"_"!==t.origin[0]).map(t=>this.yt.get(t)).map(t=>t.restore()).map(t=>d(t.owner)).map((e,r)=>t.inputs[r].script.toBuffer().length?0:e.domain()),r=n.deps.Buffer;e.forEach((e,n)=>t.inputs[n].setScript(r.alloc(e)))}Ye(t){if(this.Ae)return;const e=this.me.filter(t=>"_"!==t.origin[0]);t.inputs.slice(0,e.length).forEach(t=>t.setScript(""))}async ze(t){this.xe||this.We(t);const e=this.me.filter(t=>"_"!==t.origin[0]),r=this.xe.tx.inputs.length-e.length,o=e.map(t=>this.yt.get(t)).map(t=>t.restore()).map(t=>d(t.owner)).concat(new Array(r)),s=this.xe.tx.toString("hex"),c=await t.Qe.sign(s,o);this.xe.tx=new n.Transaction(c),await i(this.xe.tx,t.je),this.Ae=!0}We(t){if(this.xe)return this.xe;const e=t.je,r=t.Xe,i=f(e.network),s=u(e.network),c=this.me.filter(t=>"_"!==t.origin[0]),g=new Map;this.pt.forEach(t=>{if(c.includes(t)||this.Pe.includes(t))return;const e=this.Oe.get(t.origin)||r.Ze.get(t.origin)||t.location,n=g.get(t.origin);if(n&&n!==e)throw new Error("read different locations of same jig "+t.origin);g.set(t.origin,e)});const b=Array.from(g.values()),m=t=>{let e=t;const n=Array.from(this.dt.entries()).filter(([t,r])=>r===e).map(([t,e])=>t);n.length&&(e=n[0]);const o=c.findIndex(t=>h(t,e));if(-1!==o)return"_i"+o;const i=this.Pe.findIndex(t=>h(t,e));if(-1!==i)return"_o"+(1+this.we.length+i);const s=b.indexOf(g.get(e.origin));return-1!==s?"_r"+s:r.Ze.get(e.origin)||e.location},P={ot:t.we.ot,W:o.K.Ct(o.K.q(o.K.Y(t=>{switch(l(t)){case"jig":return m(t);case"berry":return(t=>{const e=a.parse(t.location).error;if(e)throw new Error("Cannot serialize berry: "+e);return t.location})(t);case"code":return"_"===(e=t)["location"+i][0]?"_o"+(parseInt(e["location"+i].slice(2))+1):e["location"+i];default:throw new Error("Unknown resource type: "+p(t))}var e}),o.K.X()))},O=this.be.map(t=>{const{method:e}=t,n=o.et(t.args,P);if("init"===e){const r=t.target.constructor["origin"+i]||t.target.constructor["location"+i];return{target:"_"===r[0]?"_o"+(1+parseInt(r.slice(2))):r,method:e,args:n,creator:o.et(t.creator,P)}}const s=c.findIndex(e=>h(e,t.target));if(-1!==s)return{target:"_i"+s,method:e,args:n};const a=this.Pe.findIndex(e=>h(e,t.target));return-1!==a?{target:"_o"+(1+this.we.length+a),method:e,args:n}:{target:"_"!==t.target.location[0]?t.target.location:r.Ze.get(t.target.origin),method:e,args:n}}),E={code:this.we.map(t=>{const e=Object.entries(t.deps).map(([t,e])=>{return{[t]:(r=e["location"+i],"_"===r[0]?"_o"+(1+parseInt(r.slice(2))):r)};var r}),r=e.length?Object.assign(...e):void 0,n=Object.keys(t.props).length?o.et(t.props,P):void 0,s=o.et(t.owner,P);return{text:y(t.T),deps:r,props:n,owner:s}}),actions:O,jigs:this.Pe.length,refs:b.length?b:void 0},v=_(E),{Buffer:S}=n.deps,A=S.from("run","utf8"),x=S.from([w],"hex"),I=S.from(t.tr,"utf8"),T=S.from(v,"utf8"),j=S.from("r11r","utf8"),$=n.Script.buildSafeDataOut([A,x,I,T,j]),R=(new n.Transaction).addOutput(new n.Transaction.Output({script:$,satoshis:0})),k=c.map(t=>this.Oe.get(t.origin)||r.Ze.get(t.origin)||t.location);return c.forEach((t,e)=>{const r=k[e].slice(0,64),o=parseInt(k[e].slice(66)),i=this.yt.get(t),c=Math.max(n.Transaction.DUST_AMOUNT,i.restore().satoshis),a=d(i.restore().owner,s).script(),u={txid:r,vout:o,script:n.Script.fromBuffer(S.from(a)),satoshis:c};R.from(u)}),this.we.forEach(t=>{const e=d(t.owner,s).script(),r=n.Script.fromBuffer(S.from(e)),o=n.Transaction.DUST_AMOUNT;R.addOutput(new n.Transaction.Output({script:r,satoshis:o}))}),this.Pe.forEach(t=>{const e=this._e.get(t).restore(),r=d(e.owner,s).script(),o=n.Script.fromBuffer(S.from(r)),i=Math.max(n.Transaction.DUST_AMOUNT,e.satoshis);R.addOutput(new n.Transaction.Output({script:o,satoshis:i}))}),R.outputs.forEach(t=>{t.spentTxId=null,t.spentIndex=null,t.spentHeight=null}),this.xe={tx:R,refs:b,Me:c,Ce:k},this.xe}}},function(t,e,r){const hex=r(13);function asm(t){const e=t.split(" ");let r=[];for(const t of e){if(void 0!==asm.OP_CODES[t]){r.push(asm.OP_CODES[t]);continue}const e=hex(t);if(0!==e[0])if(1===e.length&&e[0]>=1&&e[0]<=16)r.push(e[0]+80);else if(e.length<=75)r=r.concat(e.length).concat(e);else if(e.length<256)r=r.concat(asm.OP_CODES.OP_PUSHDATA1).concat([e.length]).concat(e);else if(e.length<65536){const t=[e.length/256,e.length%256];r=r.concat(asm.OP_CODES.OP_PUSHDATA2).concat(t).concat(e)}else{if(!(e.length<4294967296))throw new Error("Hex data too long");{const t=[e.length/256/256/256,e.length/256/256%256,e.length/256%256,e.length%256];r=r.concat(asm.OP_CODES.OP_PUSHDATA4).concat(t).concat(e)}}else r.push(e[0])}return new Uint8Array(r)}asm.OP_CODES={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_IF:99,OP_NOTIF:100,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SPLIT:127,OP_NUM2BIN:128,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_1ADD:139,OP_1SUB:140,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255},asm.deps={hex},asm.originMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o1",asm.locationMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o1",asm.ownerMainnet="1CscRyquNBh5UAVYhfxvy1HfnQrSLe85MG",asm.originTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o1",asm.locationTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o1",asm.ownerTestnet="mqvDyKXEfdbUYTepHbi3vvtCxRrGVDgGcb",t.exports=asm},function(t,e){function expect(t){let e=!1;const r=t=>{if("object"!=typeof t||!t)return t;try{return JSON.stringify(t)}catch(e){return t.toString()}};function n(n,o,i){if(e?n:!n)throw new Error(i||`expected value${e?" not":""} to be ${o} but was ${r(t)}`)}return{get not(){return e=!e,this},toBe:(e,o)=>n(t===e,""+r(e),o),toEqual:(e,o)=>n(function t(e,r){return typeof e==typeof r&&("object"==typeof e&&"object"==typeof r?null===e&&null===r||null!==e&&null!==r&&(Object.keys(e).length===Object.keys(r).length&&Object.keys(e).every(n=>t(e[n],r[n]))):e===r)}(t,e),"equal to "+r(e),o),toBeInstanceOf:(e,r)=>n(t&&t instanceof e,"an instance of "+e.name,r),toBeDefined:e=>n(void 0!==t,"defined",e),toBeNull:e=>n(null===t,"null",e),toBeNumber:e=>n("number"==typeof t,"a number",e),toBeInteger:e=>n(Number.isInteger(t),"an integer",e),toBeLessThan:(e,r)=>n(t<e&&"number"==typeof t&&"number"==typeof e,"less than "+e,r),toBeLessThanOrEqualTo:(e,r)=>n(t<=e&&"number"==typeof t&&"number"==typeof e,"less than or equal to "+e,r),toBeGreaterThan:(e,r)=>n(t>e&&"number"==typeof t&&"number"==typeof e,"greater than "+e,r),toBeGreaterThanOrEqualTo:(e,r)=>n(t>=e&&"number"==typeof t&&"number"==typeof e,"greater than or equal to "+e,r),toBeBoolean:e=>n("boolean"==typeof t,"a boolean",e),toBeString:e=>n("string"==typeof t,"a string",e),toBeObject:e=>n(t&&"object"==typeof t,"an object",e),toBeArray:e=>n(Array.isArray(t),"an array",e),toBeClass:e=>n("function"==typeof t&&t.toString().startsWith("class"),"a class",e),toBeFunction:e=>n("function"==typeof t&&!t.toString().startsWith("class"),"a function",e)}}expect.originMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o3",expect.locationMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o3",expect.ownerMainnet="1CscRyquNBh5UAVYhfxvy1HfnQrSLe85MG",expect.originTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o3",expect.locationTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o3",expect.ownerTestnet="mqvDyKXEfdbUYTepHbi3vvtCxRrGVDgGcb",t.exports=expect},function(t,e,r){const{PrivateKey:n,PublicKey:o,Address:i}=r(2),s=r(23),{Blockchain:c,Logger:a,Purse:u,State:f,Lock:l,Owner:h}=r(17),{Jig}=r(3),{Berry}=r(10),p=r(32),y=r(36),g=r(37),d=r(38),w=r(39),b=r(40),_=r(41),asm=r(20),expect=r(21),GroupLock=r(42),hex=r(13),Token=r(43),StandardLock=r(16),{PROTOCOL_VERSION:m}=r(9),{F:P}=r(0),O=r(4),E=r(1);class v{constructor(t={}){t=Object.assign({},v.defaults,t),this.logger=t.logger,this.Tt=new s,this.Tt.je=function(t){const{api:e,apiKey:r,blockchain:n,network:o,timeout:i}=t;if(n instanceof c)return n;const a=s._&&s._.je;if(void 0===n)switch(o){case"mock":return a instanceof w?a:new w;case"main":case"test":case"stn":return a instanceof p&&a.api===e&&a.apiKey===r&&a.timeout===i&&a.network===o?a:new p({api:e,apiKey:r,network:o,timeout:i,lastBlockchain:a});default:throw new Error("Unsupported network: "+o)}throw new Error("Invalid blockchain: "+P(n))}(t,this.logger),this.Tt.Ke=S(t.purse,this.blockchain,t.wallet),this.Tt.tr=A(t.app),this.Tt.Ue=function(t){if(t instanceof f)return t;if(void 0===t)return v.instance&&v.instance.state?v.instance.state:new _;throw new Error("Invalid state: "+P(t))}(t.state),this.Tt.Qe=function(t,e,r){if(r){if(!(r instanceof h))throw new Error("wallet does not implement the Owner API");return r}if(t instanceof h)return t;if(void 0===t||"string"==typeof t||t instanceof n)try{return new y({privkey:t,blockchain:e})}catch(t){}if("string"==typeof t||t instanceof o||t instanceof i)try{return new d(t.toString())}catch(t){}if("object"==typeof t)try{return new d(t)}catch(t){}throw new Error("Invalid owner: "+P(t))}(t.owner,this.blockchain,t.wallet),this.Tt.we=t.code,this.Tt.er(),this.blockchain instanceof w&&this.purse instanceof g&&this.blockchain.fund(this.purse.bsvAddress,1e8),this.activate()}get app(){return this.Tt.tr}get blockchain(){return this.Tt.je}get code(){return this.Tt.we}get inventory(){return this.Tt.De}get logger(){return E.it}get owner(){return function(t,e){const r=t=>{const e=`run.owner.${t} is now deprecated.`,r="Please switch to run.inventory."+t;E.at("Owner",`${e} ${r}`)};"jigs"in t||Object.defineProperty(t,"jigs",{configurable:!0,enumerable:!0,get:()=>{r("jigs");try{return e.jigs}catch(t){return[]}}});"code"in t||Object.defineProperty(t,"code",{configurable:!0,enumerable:!0,get:()=>{r("code");try{return e.code}catch(t){return[]}}});return t}(this.Tt.Qe,this.inventory)}get purse(){return this.Tt.Ke}get wallet(){return this.Tt.Ke===this.Tt.Qe?this.Tt.Ke:void 0}get sandbox(){return this.Tt.rr}get state(){return this.Tt.Ue}get transaction(){return this.Tt.Re}set app(t){this.Tt.tr=A(t)}set logger(t){this.it=E.it=function(t){if(t instanceof a)return t;if(void 0===t)return E.st;if(null===t)return{};throw new Error("Invalid logger: "+P(t))}(t)}set purse(t){this.Tt.Ke=S(t,this.blockchain)}async load(t,e){return this.nr(),this.Tt.or(t,{ne:e})}async deploy(t){return this.nr(),this.Tt.Je(t),await this.Tt.Xe.ir(),t.location}async sync(){await this.Tt.Xe.ir(),await this.Tt.De.sync()}activate(){return this.Tt.sr(),v.instance=this,E.it=this.it,this}deactivate(){return this.Tt.cr(),E.it=E.st,v.instance=null,this}nr(){if(v.instance!==this){throw new Error("This Run instance is not active\n\n"+"Hint: Call run.activate() on this instance first")}}}function S(t,e,r){if(r){if(!(r instanceof u))throw new Error("wallet does not implement the Purse API");return r}if(t instanceof u)return t;switch(typeof t){case"string":return new g({privkey:t,blockchain:e});case"undefined":return new g({blockchain:e});case"object":if(t instanceof n)return new g({privkey:t,blockchain:e})}throw new Error("Invalid purse: "+P(t))}function A(t){switch(typeof t){case"string":return t;case"undefined":return"";default:throw new Error("Invalid app: "+P(t))}}v.defaults={},v.defaults.app="",v.defaults.network="main",v.defaults.logger=void 0,v.defaults.api=void 0,v.defaults.apiKey=void 0,v.defaults.purse=void 0,v.defaults.owner=void 0,v.configure=(t,e)=>{t.APP&&(v.defaults.app=t.APP),e=e||t.NETWORK||v.defaults.network,v.defaults.network=e,t.LOGGER&&(v.defaults.logger=JSON.parse(t.LOGGER)?console:{}),v.ur.ar.it=v.defaults.logger;const r=t.PURSE||t["PURSE_"+e.toUpperCase()];void 0!==r&&(v.defaults.purse=r);const n=t.OWNER||t["OWNER_"+e.toUpperCase()];void 0!==n&&(v.defaults.owner=n),void 0!==t.API&&(v.defaults.api=t.API);const o=t.APIKEY||t["APIKEY_"+(v.defaults.api||"").toUpperCase()];void 0!==o&&(v.defaults.apiKey=o)},v.Berry=Berry,v.Jig=Jig,v.StandardLock=StandardLock,v.BlockchainApi=p,v.LocalOwner=y,v.LocalPurse=g,v.Mockchain=w,v.PayServer=b,v.StateCache=_,v.Viewer=d,v.asm=asm,v.expect=expect,v.GroupLock=GroupLock,v.hex=hex,v.Token=Token,v.ur={},v.ur.lr=r(18),v.ur.hr=r(6),v.ur.ar=r(1),v.ur.pr=r(12),v.ur.yr=r(5),v.ur.gr=r(8).ResourceSet,v.ur.dr=r(8).ResourceMap,Object.assign(v.ur,r(7)),Object.assign(v.ur,r(0)),Object.assign(v.ur,r(9)),v.api={},v.api.Blockchain=c,v.api.Logger=a,v.api.Purse=u,v.api.State=f,v.api.Lock=l,v.api.Owner=h,v.errors=r(11),v.sandbox=O,v.instance=null,v.version="0.5.30",v.protocol=m,t.exports=v},function(t,e,r){const n=r(2),o=r(24),i=r(27),s=r(29),c=r(30),a=r(31),{I:u,G:f}=r(0);class l{constructor(){this.je=null,this.Ke=null,this.Ue=null,this.tr=null,this.Qe=null,this.rr=!0,this.we=null,this.Xe=null,this.It=null,this.wr=null,this.Re=null,this.De=null,this.br=new f}er(){if(!this.we)if(l._){l._.rr.toString()===this.rr.toString()?this.we=l._.we:(l._.we.deactivate(),this.we=new o(this))}else this.we=new o(this);this.Xe=new i(this),this.It=new s(this),this.Re=new a(this),this.De=new c(this)}or(t,e){return this.br.enqueue(()=>this.Re.load(t,e))}Je(t){this.we.deploy(t)}Re(t){this.Re.Re(t)}sr(){l._!==this&&(l._&&l._.cr(),l._=this,n.Networks.defaultNetwork=n.Networks[u(this.je.network)],this.we.activate(this.je.network))}cr(){l._&&(l._=null)}}l._=null,t.exports=l},function(t,e,r){const{Jig,JigControl,kt:n}=r(3),{Berry,oe:o}=r(10),i=r(4),{j:s,$:c,R:a,L:u,A:f,F:l}=r(0),h=r(1),p=r(5),y=["origin","location","owner","originMainnet","locationMainnet","ownerMainnet","originTestnet","locationTestnet","ownerTestnet","originStn","locationStn","ownerStn","originMocknet","locationMocknet","ownerMocknet"];t.exports=class{constructor(t){this.Tt=t,this.installs=new Map,this.pending=new Set,this._r(),this.mr()}isSandboxed(t){const e=this.installs.get(t);return e&&t===e}jt(t){return this.isSandboxed(t)?t:this.installs.get(t)}se(t){return this.deploy(t,{Pr:!0})}extractProps(t){const e=["deps",...y],r=Object.keys(t).filter(t=>!e.includes(t)),n={};r.forEach(e=>{n[e]=t[e]});const o=[];try{p.et(n,{W:p.K.Ct(p.K.q(p.K.Y(t=>(o.push(t),{})),p.K.X()))})}catch(e){throw new Error(`A static property of ${t.name} is not supported\n\n${e}`)}return{props:n,refs:o}}deploy(t,e={}){if(this.pending.has(t))return;if(t===this.Jig||t===Jig)return this.Jig;if(t===this.Berry||t===Berry)return this.Berry;if(!c(t))throw new Error(t+" is not deployable");h.ct("Code","Deploying",t.name);const r=this.installs.get(t),n=f(),o=s(n.blockchain.network);if(r&&Object.keys(r).includes("origin"+o)&&Object.keys(r).includes("location"+o))return r;const u=Object.keys(t);if(u.includes("location"+o)){const e=this.installs.get(t["location"+o]);if(e)return e}if(u.includes("deps")&&(l=t.deps,null!==Object.getPrototypeOf(Object.getPrototypeOf(l))))throw new Error("deps must be an object");var l;y.forEach(e=>{if((e=>u.includes(e)&&"string"!=typeof t[e])(e))throw new Error(`${e} must be a string: ${t[e]}`)}),n.transaction.begin();try{const r={},s=Object.getPrototypeOf(t),c=u.includes("deps")?Object.assign({},t.deps):{},f=i._.O.Object;if(s!==Object.getPrototypeOf(Object)&&s!==f.getPrototypeOf(f)){if(r[s.name]=this.deploy(s,e),c[s.name]){if(this.jt(c[s.name])!==r[s.name])throw new Error("unexpected parent dependency "+s.name)}s.name in c||s===this.installs.get(Jig)||s===Jig||s===this.installs.get(Berry)||s===Berry||(c[s.name]=s)}const l=this.installs.get(t);if(l&&Object.keys(l).includes("origin"+o)&&Object.keys(l).includes("location"+o))return l;const[h,g]=this.Ut(t,r);this.installs.set(t,h),this.installs.set(h,h);const d=[],w=t=>(d.push(t),d.length-1),b=t=>this.jt(d[t])||d[t],_={W:p.K.Ct(p.K.q(p.K.Y(w),p.K.X())),Z:p.tt.q(p.tt.Y(b),p.tt.X())},m=Object.assign({},t);let P=null;try{P=p.et(m,_)}catch(e){throw new Error(`A static property of ${t.name} is not supported\n\n${e}`)}if(u.includes("origin"+o)||u.includes("location"+o))u.includes("origin"+o)&&(h["origin"+o]=h.origin=t.origin=t["origin"+o]),h["location"+o]=h.location=t.location=t["location"+o]||t.origin,h["owner"+o]=h.owner=t.owner=t["owner"+o],this.installs.set(h["location"+o],h);else if(e.Pr){const e="!Not deployed";h["origin"+o]=h.origin=t.origin=t["origin"+o]=e,h["location"+o]=h.location=t.location=t["location"+o]||t.origin,h["owner"+o]=h.owner=t.owner=t["owner"+o]=null}else{const e=n.blockchain.network,r=r=>{n.blockchain.network===e&&(t.origin=t.location=h.origin=h.location=r,t.owner=h.owner=t["owner"+o]),h["origin"+o]=h["location"+o]=r,t["origin"+o]=t["location"+o]=r,this.installs.set(r,h)},i=()=>{n.blockchain.network===e&&(delete t.origin,delete t.location,delete h.origin,delete h.location,delete t.owner,delete h.owner),delete t["origin"+o],delete t["location"+o],delete h["origin"+o],delete h["location"+o],delete t["owner"+o],delete h["owner"+o]},s=Object.assign({},m);y.forEach(t=>{delete s[t]}),delete s.deps;let a=null;try{this.pending.add(t),a=n.transaction.Ne(t,h,c,s,r,i)}finally{this.pending.delete(t)}t["origin"+o]=t["location"+o]=t.origin=t.location=a,h["origin"+o]=h["location"+o]=h.origin=h.location=a,t["owner"+o]=h["owner"+o]=h.owner=t.owner}d.filter(t=>"code"===a(t)).forEach(t=>this.deploy(t,e));try{const t=p.rt(P,_);Object.assign(h,t)}catch(e){throw new Error(`A static property of ${t.name} cannot be sandboxed\n\n${e}`)}return g&&Object.entries(c).forEach(([t,n])=>{n!==s&&n!==r[s.name]&&(g[t]=this.deploy(n,e))}),g&&this.Or(g),h}finally{n.transaction.end()}}async $e(t,e,r,n,o,c=new Map){if(this.installs.has(e))return this.installs.get(e);if(c.has(e))return c.get(e);h.ct("Code","Installing",l(t.text),"from",e);const a=e.slice(0,64),f=parseInt(e.slice(66)),y={};let g=null,d=null;const w=new Promise((t,e)=>{g=t,d=e});c.set(e,w);try{const l=/^class \w* extends (\w*)[\s]*{/;let h=null;if(l.test(t.text)){h=t.text.match(l)[1];let e=(t.deps||{})[h];"Jig"===h&&void 0===e?y.Jig=this.Jig:"Berry"===h&&void 0===e?y.Berry=this.Berry:(e.startsWith("_")&&(e=r.hash+e),y[h]=await n.Re.load(e,{Er:c}))}const[d,w]=i._.Nt(t.text,y);d.origin=d.location=e;const b=s(n.je.network);if(d["origin"+b]=d["location"+b]=e,g(d),w){const e=Object.entries(t.deps||{}).map(([t,e])=>{if(t===h)return;const o=e.startsWith("_")?r.hash+e:e;return n.Re.load(o,{Er:c}).then(e=>{w[t]=e})});await Promise.all(e)}t.deps&&(d.deps={},Object.keys(t.deps).forEach(t=>{d.deps[t]=w&&w[t]||y[t]})),w&&this.Or(w);const _=new Map,m=p.Ht(t.owner),P=async t=>{const e="i"===t[1]||"o"===t[1]?a+t:t,r=await n.Re.load(e,{Er:c});_.set(t,r)},O=m.map(t=>P(t));await Promise.all(O);const E=p.rt(t.owner,{Z:p.tt.q(p.tt.Y(t=>_.get(t)),p.tt.X())});if(d.owner=E,d["owner"+b]=E,r.outputs[f].script.toHex()!==Buffer.from(u(E,o).script()).toString("hex"))throw new Error("bad def owner: "+e);if(t.props){const e=new Map,r=p.Ht(t.props),o=async t=>{const r="i"===t[1]||"o"===t[1]?a+t:t,o=await n.Re.load(r,{Er:c});e.set(t,o)},i=r.map(t=>o(t));await Promise.all(i);const s=p.rt(t.props,{Z:p.tt.q(p.tt.Y(t=>e.get(t)),p.tt.X())});Object.assign(d,s)}if(c.delete(e),this.installs.has(e)){throw new Error(`Code installed twice for ${e}\n\n${"This is an internal Run bug. Please report it to the library developers."}.`)}return this.installs.set(e,d),this.installs.set(d,d),d}catch(t){throw d(t),t}}_r(){this.Jig=this.Ut(Jig,n)[0],this.installs.set(Jig,this.Jig),this.installs.set(this.Jig,this.Jig)}mr(){this.Berry=this.Ut(Berry,o)[0],this.installs.set(Berry,this.Berry),this.installs.set(this.Berry,this.Berry)}Ut(t,e){const r=this.installs.get(t);return r?[r,null]:i._.Ut(t,e)}Or(t){"caller"in t||Object.defineProperty(t,"caller",{get:()=>JigControl.Rt(),set:()=>{throw new Error("Must not set caller")},configurable:!0,enumerable:!0})}activate(t){const e=s(t);this.installs.forEach((t,r)=>{"string"!=typeof r&&(void 0!==r["origin"+e]?(r.origin=r["origin"+e],t.origin=r["origin"+e]):(delete r.origin,delete t.origin),void 0!==r["location"+e]?(r.location=r["location"+e],t.location=r["location"+e]):(delete r.location,delete t.location),void 0!==r["owner"+e]?(r.owner=r["owner"+e],t.owner=r["owner"+e]):(delete r.owner,delete t.owner))})}}},function(t,e,r){t.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.u)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.u?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){const n=r(1);n.version="0.1.10",n.variant="node",t.exports=n},function(t,e,r){const n=r(2),{makeDeterministic:o,nonDeterministicIntrinsics:i}=r(3);t.exports=class{constructor(){const t=`var m=${o.toString()};m();`;{const e=r(4);this.Compartment=e.runInNewContext(`${t};${n};SES.lockdown();Compartment`)}this.globalOverrides={},i.forEach(t=>{this.globalOverrides[t]=void 0});const e=this.makeNondeterministicCompartment();e.global.c=console,this.globalOverrides.console=e.evaluate("Object.assign(...Object.entries(c).map(([k, f])=>({[k]:(...a)=>f(...a)})))")}makeCompartment(){const t=this.makeNondeterministicCompartment();return Object.assign(t.global,this.globalOverrides),{evaluate:e=>t.evaluate(e),global:new Proxy({},{set:(e,r,n)=>(e[r]=t.global[r]=n,!0),deleteProperty:(e,r)=>(delete e[r],r in this.globalOverrides?t.global[r]=this.globalOverrides[r]:delete t.global[r],!0),defineProperty:(e,r,n)=>(Object.defineProperty(e,r,n),Object.defineProperty(t.global,r,n),!0)})}}makeNondeterministicCompartment(){return new this.Compartment}}},function(t){t.exports=JSON.parse('"!function(t,o){\\"object\\"==typeof exports&&\\"undefined\\"!=typeof module?o(exports):\\"function\\"==typeof define&&define.amd?define([\\"exports\\"],o):o((t=t||self).SES={})}(this,(function(t){\\"use strict\\";function o(t,o){if(!t)throw new TypeError(o)}const{getPrototypeOf:r}=Object;const{getOwnPropertyDescriptor:e,getPrototypeOf:n}=Object;function a(t){return n(t).constructor}const i=[\\"Array\\",\\"ArrayBuffer\\",\\"ArrayBufferPrototype\\",\\"ArrayIteratorPrototype\\",\\"ArrayPrototype\\",\\"AsyncFunction\\",\\"AsyncFunctionPrototype\\",\\"AsyncGenerator\\",\\"AsyncGeneratorFunction\\",\\"AsyncGeneratorPrototype\\",\\"AsyncIteratorPrototype\\",\\"Atomics\\",\\"BigInt\\",\\"BigIntPrototype\\",\\"BigInt64Array\\",\\"BigInt64ArrayPrototype\\",\\"BigUint64Array\\",\\"BigUint64ArrayPrototype\\",\\"Boolean\\",\\"BooleanPrototype\\",\\"DataView\\",\\"DataViewPrototype\\",\\"Date\\",\\"DatePrototype\\",\\"decodeURI\\",\\"decodeURIComponent\\",\\"encodeURI\\",\\"encodeURIComponent\\",\\"Error\\",\\"ErrorPrototype\\",\\"eval\\",\\"EvalError\\",\\"EvalErrorPrototype\\",\\"Float32Array\\",\\"Float32ArrayPrototype\\",\\"Float64Array\\",\\"Float64ArrayPrototype\\",\\"Function\\",\\"FunctionPrototype\\",\\"Generator\\",\\"GeneratorFunction\\",\\"GeneratorPrototype\\",\\"Int8Array\\",\\"Int8ArrayPrototype\\",\\"Int16Array\\",\\"Int16ArrayPrototype\\",\\"Int32Array\\",\\"Int32ArrayPrototype\\",\\"isFinite\\",\\"isNaN\\",\\"IteratorPrototype\\",\\"JSON\\",\\"Map\\",\\"MapIteratorPrototype\\",\\"MapPrototype\\",\\"Math\\",\\"Number\\",\\"NumberPrototype\\",\\"Object\\",\\"ObjectPrototype\\",\\"parseFloat\\",\\"parseInt\\",\\"Promise\\",\\"PromisePrototype\\",\\"Proxy\\",\\"RangeError\\",\\"RangeErrorPrototype\\",\\"ReferenceError\\",\\"ReferenceErrorPrototype\\",\\"Reflect\\",\\"RegExp\\",\\"RegExpPrototype\\",\\"RegExpStringIteratorPrototype\\",\\"Set\\",\\"SetIteratorPrototype\\",\\"SetPrototype\\",\\"SharedArrayBuffer\\",\\"SharedArrayBufferPrototype\\",\\"String\\",\\"StringIteratorPrototype\\",\\"StringPrototype\\",\\"Symbol\\",\\"SymbolPrototype\\",\\"SyntaxError\\",\\"SyntaxErrorPrototype\\",\\"ThrowTypeError\\",\\"TypedArray\\",\\"TypedArrayPrototype\\",\\"TypeError\\",\\"TypeErrorPrototype\\",\\"Uint8Array\\",\\"Uint8ArrayPrototype\\",\\"Uint8ClampedArray\\",\\"Uint8ClampedArrayPrototype\\",\\"Uint16Array\\",\\"Uint16ArrayPrototype\\",\\"Uint32Array\\",\\"Uint32ArrayPrototype\\",\\"URIError\\",\\"URIErrorPrototype\\",\\"WeakMap\\",\\"WeakMapPrototype\\",\\"WeakSet\\",\\"WeakSetPrototype\\",\\"escape\\",\\"unescape\\",\\"FunctionPrototypeConstructor\\",\\"Compartment\\",\\"CompartmentPrototype\\",\\"harden\\"],{getOwnPropertyDescriptor:c}=Object;function p(t,r){const e=c(t,r);return o(!(\\"get\\"in e||\\"set\\"in e),`unexpected accessor on global property: ${r}`),e.value}const{apply:s}=Reflect,y=(t=>(o,...r)=>s(t,o,r))(Object.prototype.hasOwnProperty);function l(){const t={__proto__:null},c=function(){const t=Function.prototype.constructor,o=typeof Symbol&&Symbol.iterator||\\"@@iterator\\",r=typeof Symbol&&Symbol.matchAll||\\"@@matchAll\\",i=e(arguments,\\"callee\\").get,c=(new String)[o](),p=n(c);let s=null,y=null;r in new RegExp&&(s=(new RegExp)[r](),y=n(s));const l=(new Array)[o](),u=n(l),g=n(Float32Array),f=(new Map)[o](),P=n(f),b=(new Set)[o](),m=n(b),d=n(u);function*h(){}const A=a(h),E=A.prototype;async function*S(){}const _=a(S),w=_.prototype,I=w.prototype,F=n(I);async function T(){}const v=a(T),O={FunctionPrototypeConstructor:t,ArrayIteratorPrototype:u,AsyncFunction:v,AsyncGenerator:w,AsyncGeneratorFunction:_,AsyncGeneratorPrototype:I,AsyncIteratorPrototype:F,Generator:E,GeneratorFunction:A,IteratorPrototype:d,MapIteratorPrototype:P,RegExpStringIteratorPrototype:y,SetIteratorPrototype:m,StringIteratorPrototype:p,ThrowTypeError:i,TypedArray:g};return O}();!function(t){const{FunctionPrototypeConstructor:e,ArrayIteratorPrototype:n,AsyncFunction:a,AsyncGenerator:i,AsyncGeneratorFunction:c,AsyncGeneratorPrototype:p,AsyncIteratorPrototype:s,Generator:y,GeneratorFunction:l,IteratorPrototype:u,MapIteratorPrototype:g,RegExpStringIteratorPrototype:f,SetIteratorPrototype:P,StringIteratorPrototype:b,ThrowTypeError:m,TypedArray:d}=t;o(r(m)===Function.prototype,\\"ThrowTypeError.__proto__ should be Function.prototype\\"),o(r(b)===u,\\"StringIteratorPrototype.__proto__ should be IteratorPrototype\\"),f&&o(r(f)===u,\\"RegExpStringIteratorPrototype.__proto__ should be IteratorPrototype\\"),o(r(d)===Function.prototype,\\"TypedArray.__proto__ should be Function.prototype\\"),o(r(g)===u,\\"MapIteratorPrototype.__proto__ should be IteratorPrototype\\"),o(r(P)===u,\\"SetIteratorPrototype.__proto__ should be IteratorPrototype\\"),o(r(u)===Object.prototype,\\"IteratorPrototype.__proto__ should be Object.prototype\\"),o(r(s)===Object.prototype,\\"AsyncIteratorPrototype.__proto__ should be Object.prototype\\"),o(r(n)===u,\\"AsyncIteratorPrototype.__proto__ should be IteratorPrototype\\"),o(r(l)===e,\\"GeneratorFunction.__proto__ should be Function\\"),o(\\"GeneratorFunction\\"===l.name,\'GeneratorFunction.name should be \\"GeneratorFunction\\"\'),o(r(y)===Function.prototype,\\"Generator.__proto__ should be Function.prototype\\"),o(r(c)===e,\\"AsyncGeneratorFunction.__proto__ should be Function\\"),o(\\"AsyncGeneratorFunction\\"===c.name,\'AsyncGeneratorFunction.name should be \\"AsyncGeneratorFunction\\"\'),o(r(i)===Function.prototype,\\"AsyncGenerator.__proto__ should be Function.prototype\\"),o(r(p)===s,\\"AsyncGeneratorPrototype.__proto__ should be AsyncIteratorPrototype\\"),o(r(a)===e,\\"AsyncFunction.__proto__ should be Function\\"),o(\\"AsyncFunction\\"===a.name,\'AsyncFunction.name should be \\"AsyncFunction\\"\')}(c);for(const o of i){if(y(c,o)){t[o]=c[o];continue}if(y(globalThis,o)){t[o]=p(globalThis,o);continue}if(o.endsWith(\\"Prototype\\")){const r=o.slice(0,-\\"Prototype\\".length);if(y(c,r)){const e=c[r];t[o]=e.prototype;continue}if(y(globalThis,r)){const e=p(globalThis,r);t[o]=e.prototype;continue}}}return function(t){Object.keys(t).forEach(o=>{if(void 0===t[o])throw new TypeError(`Malformed intrinsic: ${o}`)})}(t),t}const u={\\"**proto**\\":\\"FunctionPrototype\\",length:\\"number\\",name:\\"string\\"},g=u,f={get:g,set:\\"undefined\\"};function P(t){return{\\"**proto**\\":\\"Error\\",prototype:t,length:\\"number\\",name:\\"string\\"}}function b(t){return{\\"**proto**\\":\\"ErrorPrototype\\",constructor:t,message:\\"string\\",name:\\"string\\",toString:g}}function m(t){return{\\"**proto**\\":\\"TypedArray\\",length:\\"number\\",name:\\"string\\",BYTES_PER_ELEMENT:\\"number\\",prototype:t}}function d(t){return{\\"**proto**\\":\\"TypedArrayPrototype\\",BYTES_PER_ELEMENT:\\"number\\",constructor:t}}var h=function(t){return(typeof Symbol&&Symbol.matchAll||\\"@@matchAll\\")in new RegExp||delete t.RegExpStringIteratorPrototype,t}({\\"**proto**\\":null,ThrowTypeError:g,Infinity:\\"number\\",NaN:\\"number\\",undefined:\\"undefined\\",eval:g,isFinite:g,isNaN:g,parseFloat:g,parseInt:g,decodeURI:g,decodeURIComponent:g,encodeURI:g,encodeURIComponent:g,Object:{\\"**proto**\\":\\"FunctionPrototype\\",assign:g,create:g,defineProperties:g,defineProperty:g,entries:g,freeze:g,fromEntries:g,getOwnPropertyDescriptor:g,getOwnPropertyDescriptors:g,getOwnPropertyNames:g,getOwnPropertySymbols:g,getPrototypeOf:g,is:g,isExtensible:g,isFrozen:g,isSealed:g,keys:g,preventExtensions:g,prototype:\\"ObjectPrototype\\",seal:g,setPrototypeOf:g,values:g},ObjectPrototype:{\\"**proto**\\":null,constructor:\\"Object\\",hasOwnProperty:g,isPrototypeOf:g,propertyIsEnumerable:g,toLocaleString:g,toString:g,valueOf:g,__defineGetter__:g,__defineSetter__:g,__lookupGetter__:g,__lookupSetter__:g},Function:{\\"**proto**\\":\\"FunctionPrototype\\",length:\\"number\\",prototype:\\"FunctionPrototype\\"},FunctionPrototype:{length:\\"number\\",name:\\"string\\",apply:g,bind:g,call:g,constructor:\\"FunctionPrototypeConstructor\\",toString:g,\\"@@hasInstance\\":g},Boolean:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"BooleanPrototype\\"},BooleanPrototype:{constructor:\\"Boolean\\",toString:g,valueOf:g},Symbol:{\\"**proto**\\":\\"FunctionPrototype\\",asyncIterator:\\"symbol\\",for:g,hasInstance:\\"symbol\\",isConcatSpreadable:\\"symbol\\",iterator:\\"symbol\\",keyFor:g,match:\\"symbol\\",matchAll:\\"symbol\\",prototype:\\"SymbolPrototype\\",replace:\\"symbol\\",search:\\"symbol\\",species:\\"symbol\\",split:\\"symbol\\",toPrimitive:\\"symbol\\",toStringTag:\\"symbol\\",unscopables:\\"symbol\\"},SymbolPrototype:{constructor:\\"Symbol\\",description:f,toString:g,valueOf:g,\\"@@toPrimitive\\":g,\\"@@toStringTag\\":\\"string\\"},Error:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"ErrorPrototype\\",captureStackTrace:g,stackTraceLimit:\\"number\\"},ErrorPrototype:{constructor:\\"Error\\",message:\\"string\\",name:\\"string\\",toString:g},EvalError:P(\\"EvalErrorPrototype\\"),RangeError:P(\\"RangeErrorPrototype\\"),ReferenceError:P(\\"ReferenceErrorPrototype\\"),SyntaxError:P(\\"SyntaxErrorPrototype\\"),TypeError:P(\\"TypeErrorPrototype\\"),URIError:P(\\"URIErrorPrototype\\"),EvalErrorPrototype:b(\\"EvalError\\"),RangeErrorPrototype:b(\\"RangeError\\"),ReferenceErrorPrototype:b(\\"ReferenceError\\"),SyntaxErrorPrototype:b(\\"SyntaxError\\"),TypeErrorPrototype:b(\\"TypeError\\"),URIErrorPrototype:b(\\"URIError\\"),Number:{\\"**proto**\\":\\"FunctionPrototype\\",EPSILON:\\"number\\",isFinite:g,isInteger:g,isNaN:g,isSafeInteger:g,MAX_SAFE_INTEGER:\\"number\\",MAX_VALUE:\\"number\\",MIN_SAFE_INTEGER:\\"number\\",MIN_VALUE:\\"number\\",NaN:\\"number\\",NEGATIVE_INFINITY:\\"number\\",parseFloat:g,parseInt:g,POSITIVE_INFINITY:\\"number\\",prototype:\\"NumberPrototype\\"},NumberPrototype:{constructor:\\"Number\\",toExponential:g,toFixed:g,toLocaleString:g,toPrecision:g,toString:g,valueOf:g},BigInt:{\\"**proto**\\":\\"FunctionPrototype\\",asIntN:g,asUintN:g,prototype:\\"BigIntPrototype\\"},BigIntPrototype:{constructor:\\"BigInt\\",toLocaleString:g,toString:g,valueOf:g,\\"@@toStringTag\\":\\"string\\"},Math:{E:\\"number\\",LN10:\\"number\\",LN2:\\"number\\",LOG10E:\\"number\\",LOG2E:\\"number\\",PI:\\"number\\",SQRT1_2:\\"number\\",SQRT2:\\"number\\",\\"@@toStringTag\\":\\"string\\",abs:g,acos:g,acosh:g,asin:g,asinh:g,atan:g,atanh:g,atan2:g,cbrt:g,ceil:g,clz32:g,cos:g,cosh:g,exp:g,expm1:g,floor:g,fround:g,hypot:g,imul:g,log:g,log1p:g,log10:g,log2:g,max:g,min:g,pow:g,random:g,round:g,sign:g,sin:g,sinh:g,sqrt:g,tan:g,tanh:g,trunc:g},Date:{\\"**proto**\\":\\"FunctionPrototype\\",now:g,parse:g,prototype:\\"DatePrototype\\",UTC:g},DatePrototype:{constructor:\\"Date\\",getDate:g,getDay:g,getFullYear:g,getHours:g,getMilliseconds:g,getMinutes:g,getMonth:g,getSeconds:g,getTime:g,getTimezoneOffset:g,getUTCDate:g,getUTCDay:g,getUTCFullYear:g,getUTCHours:g,getUTCMilliseconds:g,getUTCMinutes:g,getUTCMonth:g,getUTCSeconds:g,setDate:g,setFullYear:g,setHours:g,setMilliseconds:g,setMinutes:g,setMonth:g,setSeconds:g,setTime:g,setUTCDate:g,setUTCFullYear:g,setUTCHours:g,setUTCMilliseconds:g,setUTCMinutes:g,setUTCMonth:g,setUTCSeconds:g,toDateString:g,toISOString:g,toJSON:g,toLocaleDateString:g,toLocaleString:g,toLocaleTimeString:g,toString:g,toTimeString:g,toUTCString:g,valueOf:g,\\"@@toPrimitive\\":g,getYear:g,setYear:g,toGMTString:g},String:{\\"**proto**\\":\\"FunctionPrototype\\",fromCharCode:g,fromCodePoint:g,prototype:\\"StringPrototype\\",raw:g},StringPrototype:{length:\\"number\\",charAt:g,charCodeAt:g,codePointAt:g,concat:g,constructor:\\"String\\",endsWith:g,includes:g,indexOf:g,lastIndexOf:g,localeCompare:g,match:g,matchAll:g,normalize:g,padEnd:g,padStart:g,repeat:g,replace:g,search:g,slice:g,split:g,startsWith:g,substring:g,toLocaleLowerCase:g,toLocaleUpperCase:g,toLowerCase:g,toString:g,toUpperCase:g,trim:g,trimEnd:g,trimStart:g,valueOf:g,\\"@@iterator\\":g,substr:g,anchor:g,big:g,blink:g,bold:g,fixed:g,fontcolor:g,fontsize:g,italics:g,link:g,small:g,strike:g,sub:g,sup:g,trimLeft:g,trimRight:g},StringIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},RegExp:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"RegExpPrototype\\",\\"@@species\\":f},RegExpPrototype:{constructor:\\"RegExp\\",exec:g,dotAll:f,flags:f,global:f,ignoreCase:f,\\"@@match\\":g,\\"@@matchAll\\":g,multiline:f,\\"@@replace\\":g,\\"@@search\\":g,source:f,\\"@@split\\":g,sticky:f,test:g,toString:g,unicode:f,compile:!1},RegExpStringIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},Array:{\\"**proto**\\":\\"FunctionPrototype\\",from:g,isArray:g,of:g,prototype:\\"ArrayPrototype\\",\\"@@species\\":f},ArrayPrototype:{length:\\"number\\",concat:g,constructor:\\"Array\\",copyWithin:g,entries:g,every:g,fill:g,filter:g,find:g,findIndex:g,flat:g,flatMap:g,forEach:g,includes:g,indexOf:g,join:g,keys:g,lastIndexOf:g,map:g,pop:g,push:g,reduce:g,reduceRight:g,reverse:g,shift:g,slice:g,some:g,sort:g,splice:g,toLocaleString:g,toString:g,unshift:g,values:g,\\"@@iterator\\":g,\\"@@unscopables\\":{\\"**proto**\\":null,copyWithin:\\"boolean\\",entries:\\"boolean\\",fill:\\"boolean\\",find:\\"boolean\\",findIndex:\\"boolean\\",flat:\\"boolean\\",flatMap:\\"boolean\\",includes:\\"boolean\\",keys:\\"boolean\\",values:\\"boolean\\"}},ArrayIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},TypedArray:{\\"**proto**\\":\\"FunctionPrototype\\",from:g,of:g,prototype:\\"TypedArrayPrototype\\",\\"@@species\\":f},TypedArrayPrototype:{buffer:f,byteLength:f,byteOffset:f,constructor:\\"TypedArray\\",copyWithin:g,entries:g,every:g,fill:g,filter:g,find:g,findIndex:g,forEach:g,includes:g,indexOf:g,join:g,keys:g,lastIndexOf:g,length:f,map:g,reduce:g,reduceRight:g,reverse:g,set:g,slice:g,some:g,sort:g,subarray:g,toLocaleString:g,toString:g,values:g,\\"@@iterator\\":g,\\"@@toStringTag\\":f},BigInt64Array:m(\\"BigInt64ArrayPrototype\\"),BigUint64Array:m(\\"BigUint64ArrayPrototype\\"),Float32Array:m(\\"Float32ArrayPrototype\\"),Float64Array:m(\\"Float64ArrayPrototype\\"),Int16Array:m(\\"Int16ArrayPrototype\\"),Int32Array:m(\\"Int32ArrayPrototype\\"),Int8Array:m(\\"Int8ArrayPrototype\\"),Uint16Array:m(\\"Uint16ArrayPrototype\\"),Uint32Array:m(\\"Uint32ArrayPrototype\\"),Uint8Array:m(\\"Uint8ArrayPrototype\\"),Uint8ClampedArray:m(\\"Uint8ClampedArrayPrototype\\"),BigInt64ArrayPrototype:d(\\"BigInt64Array\\"),BigUint64ArrayPrototype:d(\\"BigUint64Array\\"),Float32ArrayPrototype:d(\\"Float32Array\\"),Float64ArrayPrototype:d(\\"Float64Array\\"),Int16ArrayPrototype:d(\\"Int16Array\\"),Int32ArrayPrototype:d(\\"Int32Array\\"),Int8ArrayPrototype:d(\\"Int8Array\\"),Uint16ArrayPrototype:d(\\"Uint16Array\\"),Uint32ArrayPrototype:d(\\"Uint32Array\\"),Uint8ArrayPrototype:d(\\"Uint8Array\\"),Uint8ClampedArrayPrototype:d(\\"Uint8ClampedArray\\"),Map:{\\"**proto**\\":\\"FunctionPrototype\\",\\"@@species\\":f,prototype:\\"MapPrototype\\"},MapPrototype:{clear:g,constructor:\\"Map\\",delete:g,entries:g,forEach:g,get:g,has:g,keys:g,set:g,size:f,values:g,\\"@@iterator\\":g,\\"@@toStringTag\\":\\"string\\"},MapIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},Set:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"SetPrototype\\",\\"@@species\\":f},SetPrototype:{add:g,clear:g,constructor:\\"Set\\",delete:g,entries:g,forEach:g,has:g,keys:g,size:f,values:g,\\"@@iterator\\":g,\\"@@toStringTag\\":\\"string\\"},SetIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},WeakMap:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"WeakMapPrototype\\"},WeakMapPrototype:{constructor:\\"WeakMap\\",delete:g,get:g,has:g,set:g,\\"@@toStringTag\\":\\"string\\"},WeakSet:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"WeakSetPrototype\\"},WeakSetPrototype:{add:g,constructor:\\"WeakSet\\",delete:g,has:g,\\"@@toStringTag\\":\\"string\\"},ArrayBuffer:{\\"**proto**\\":\\"FunctionPrototype\\",isView:g,prototype:\\"ArrayBufferPrototype\\",\\"@@species\\":f},ArrayBufferPrototype:{byteLength:f,constructor:\\"ArrayBuffer\\",slice:g,\\"@@toStringTag\\":\\"string\\"},SharedArrayBuffer:!1,DataView:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"DataViewPrototype\\"},DataViewPrototype:{buffer:f,byteLength:f,byteOffset:f,constructor:\\"DataView\\",getBigInt64:g,getBigUint64:g,getFloat32:g,getFloat64:g,getInt8:g,getInt16:g,getInt32:g,getUint8:g,getUint16:g,getUint32:g,setBigInt64:g,setBigUint64:g,setFloat32:g,setFloat64:g,setInt8:g,setInt16:g,setInt32:g,setUint8:g,setUint16:g,setUint32:g,\\"@@toStringTag\\":\\"string\\"},Atomics:!1,JSON:{parse:g,stringify:g,\\"@@toStringTag\\":\\"string\\"},IteratorPrototype:{\\"@@iterator\\":g},AsyncIteratorPrototype:{\\"@@asyncIterator\\":g},GeneratorFunction:{\\"**proto**\\":\\"FunctionPrototypeConstructor\\",name:\\"string\\",length:\\"number\\",prototype:\\"Generator\\"},Generator:{\\"**proto**\\":\\"FunctionPrototype\\",constructor:\\"GeneratorFunction\\",prototype:\\"GeneratorPrototype\\"},AsyncGeneratorFunction:{\\"**proto**\\":\\"FunctionPrototypeConstructor\\",name:\\"string\\",length:\\"number\\",prototype:\\"AsyncGenerator\\"},AsyncGenerator:{\\"**proto**\\":\\"FunctionPrototype\\",constructor:\\"AsyncGeneratorFunction\\",prototype:\\"AsyncGeneratorPrototype\\",\\"@@toStringTag\\":\\"string\\"},GeneratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",constructor:\\"Generator\\",next:g,return:g,throw:g,\\"@@toStringTag\\":\\"string\\"},AsyncGeneratorPrototype:{\\"**proto**\\":\\"AsyncIteratorPrototype\\",constructor:\\"AsyncGenerator\\",next:g,return:g,throw:g,\\"@@toStringTag\\":\\"string\\"},Promise:{\\"**proto**\\":\\"FunctionPrototype\\",all:g,allSettled:g,prototype:\\"PromisePrototype\\",race:g,reject:g,resolve:g,\\"@@species\\":f},PromisePrototype:{catch:g,constructor:\\"Promise\\",finally:g,then:g,\\"@@toStringTag\\":\\"string\\"},AsyncFunction:{\\"**proto**\\":\\"FunctionPrototypeConstructor\\",name:\\"string\\",length:\\"number\\",prototype:\\"AsyncFunctionPrototype\\"},AsyncFunctionPrototype:{\\"**proto**\\":\\"FunctionPrototype\\",constructor:\\"AsyncFunction\\",\\"@@toStringTag\\":\\"string\\"},Reflect:{apply:g,construct:g,defineProperty:g,deleteProperty:g,get:g,getOwnPropertyDescriptor:g,getPrototypeOf:g,has:g,isExtensible:g,ownKeys:g,preventExtensions:g,set:g,setPrototypeOf:g},Proxy:{\\"**proto**\\":\\"FunctionPrototype\\",revocable:g},escape:g,unescape:g,FunctionPrototypeConstructor:{\\"**proto**\\":\\"FunctionPrototype\\",length:\\"number\\",prototype:\\"FunctionPrototype\\"},Compartment:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"CompartmentPrototype\\"},CompartmentPrototype:{constructor:\\"Compartment\\",evaluate:g,global:f},harden:g});const{getPrototypeOf:A,getOwnPropertyDescriptor:E}=Object,{apply:S,ownKeys:_}=Reflect,w=(t=>(o,...r)=>S(t,o,r))(Object.prototype.hasOwnProperty);function I(t,o){if(\\"string\\"==typeof o)return o;if(\\"symbol\\"==typeof o)return`@@${o.toString().slice(14,-1)}`;throw new TypeError(`Unexpected property name type ${t} ${o}`)}function F(t){const o=[\\"undefined\\",\\"boolean\\",\\"number\\",\\"string\\",\\"symbol\\"];function r(r,e,n,i){if(\\"object\\"==typeof i)return a(r,e,i),!0;if(!1===i)return!1;if(\\"string\\"==typeof i)if(\\"prototype\\"===n||\\"constructor\\"===n){if(w(t,i))return e===t[i]}else if(o.includes(i))return typeof e===i;throw new TypeError(`Unexpected whitelist permit ${r}`)}function e(t,o,e,n){const a=E(o,e);return w(a,\\"value\\")?r(t,a.value,e,n):r(`${t}<get>`,a.get,e,n.get)&&r(`${t}<set>`,a.set,e,n.set)}function n(t,o){return w(t,o)?t[o]:\\"FunctionPrototype\\"===t[\\"**proto**\\"]&&w(u,o)?u[o]:void 0}function a(o,r,a){!function(o,r,e){const n=A(r);if(null!==n||null!==e){if(void 0!==e&&\\"string\\"!=typeof e)throw new TypeError(`Malformed whitelist permit ${o}.__proto__`);if(n!==t[e||\\"ObjectPrototype\\"])throw new Error(`Unexpected intrinsic ${o}.__proto__`)}}(o,r,a[\\"**proto**\\"]);for(const t of _(r)){if(\\"__proto__\\"===t)continue;const i=I(o,t),c=`${o}.${i}`,p=n(a,i);if(!p||!e(c,r,t,p))try{delete r[t]}catch(t){}}}a(\\"intrinsics\\",t,h)}const{defineProperties:T,getOwnPropertyDescriptors:v}=Object;const{getOwnPropertyDescriptor:O}=Object;const{defineProperties:U,getOwnPropertyDescriptors:x,getOwnPropertyDescriptor:R}=Object;const C=!0;var M={ObjectPrototype:\\"*\\",ArrayPrototype:\\"*\\",FunctionPrototype:{constructor:C,bind:C,name:C,toString:C},ErrorPrototype:{constructor:C,message:C,name:C},PromisePrototype:{constructor:C},TypedArrayPrototype:\\"*\\",Generator:{constructor:C,name:C,toString:C},IteratorPrototype:\\"*\\"};const{defineProperties:j,getOwnPropertyNames:G,getOwnPropertyDescriptor:k,getOwnPropertyDescriptors:N}=Object,{ownKeys:$}=Reflect;function D(t){return null!==t&&\\"object\\"==typeof t}const{assign:B,freeze:L,defineProperties:W,getOwnPropertyDescriptor:V,getOwnPropertyNames:z,getPrototypeOf:Y,setPrototypeOf:J,prototype:H}=Object,{apply:K,get:Q,set:X}=Reflect,{isArray:q,prototype:Z}=Array,{revocable:tt}=Proxy,{prototype:ot}=RegExp,{prototype:rt}=String,{prototype:et}=WeakMap,nt=t=>(o,...r)=>K(t,o,r),at=nt(H.hasOwnProperty),it=(nt(Z.filter),nt(Z.join)),ct=(nt(Z.push),nt(Z.pop)),pt=nt(Z.includes),st=nt(ot.test),yt=(nt(rt.match),nt(rt.search)),lt=nt(rt.slice),ut=nt(rt.split),gt=(nt(et.get),nt(et.set),nt(et.has),t=>Q(Y(t),\\"constructor\\")),ft=L({__proto__:null});function Pt(t,o){const r=`please report internal shim error: ${t}`;throw console.error(r),o&&(console.error(`${o}`),console.error(`${o.stack}`)),TypeError(r)}function bt(t,o){t||Pt(o)}const mt=[\\"await\\",\\"break\\",\\"case\\",\\"catch\\",\\"class\\",\\"const\\",\\"continue\\",\\"debugger\\",\\"default\\",\\"delete\\",\\"do\\",\\"else\\",\\"export\\",\\"extends\\",\\"finally\\",\\"for\\",\\"function\\",\\"if\\",\\"import\\",\\"in\\",\\"instanceof\\",\\"new\\",\\"return\\",\\"super\\",\\"switch\\",\\"this\\",\\"throw\\",\\"try\\",\\"typeof\\",\\"var\\",\\"void\\",\\"while\\",\\"with\\",\\"yield\\",\\"let\\",\\"static\\",\\"enum\\",\\"implements\\",\\"package\\",\\"protected\\",\\"interface\\",\\"private\\",\\"public\\",\\"await\\",\\"null\\",\\"true\\",\\"false\\",\\"this\\",\\"arguments\\"],dt=new RegExp(\\"^[a-zA-Z_$][\\\\\\\\w$]*$\\");function ht(t){return\\"eval\\"!==t&&!pt(mt,t)&&st(dt,t)}function At(t,o){const r=V(t,o);return(!1===r.configurable&&!1===r.writable&&at(r,\\"value\\"))}const Et=new Proxy(ft,{get(t,o){Pt(`unexpected scope handler trap called: ${String(o)}`)}});function St(t,o){const r=yt(t,o);return r<0?-1:ut(lt(t,0,r),\\"\\\\n\\").length}const _t=new RegExp(\\"(?:\\\\x3c!--|--\\\\x3e)\\");const wt=new RegExp(\\"\\\\\\\\bimport\\\\\\\\s*(?:\\\\\\\\(|/[/*])\\");const It=new RegExp(\\"\\\\\\\\beval\\\\\\\\s*(?:\\\\\\\\(|/[/*])\\");const Ft={rewrite:t=>(function(t){const o=St(t,_t);if(o<0)return t;throw new SyntaxError(`possible html comment syntax rejected around line ${o}`)}(t.src),function(t){const o=St(t,wt);if(o<0)return t;throw new SyntaxError(`possible import expression rejected around line ${o}`)}(t.src),function(t){const o=St(t,It);if(o<0)return t;throw new SyntaxError(`possible direct eval expression rejected around line ${o}`)}(t.src),t)};function Tt(t,o=[]){const r=function(t){return 0===t.length?\\"\\":`const {${it(t,\\",\\")}} = this;`}(o);return t.intrinsics.Function(`\\\\n    with (this) {\\\\n      ${r}\\\\n      return function() {\\\\n        \'use strict\';\\\\n        return eval(arguments[0]);\\\\n      };\\\\n    }\\\\n  `)}function vt(t,o,r,e={},{localTransforms:n=[],globalTransforms:a=[],sloppyGlobalsMode:i=!1}={}){let c={src:o,endowments:e};c=function(t,o){for(const r of o)\\"function\\"==typeof r.rewrite&&(t=r.rewrite(t));return t}(c,[...n,...a,Ft]);const p=function(t,o,r={},{sloppyGlobalsMode:e=!1}={}){return{__proto__:Et,useUnsafeEvaluator:!1,get(e,n){if(\\"symbol\\"!=typeof n)return\\"eval\\"===n&&!0===this.useUnsafeEvaluator?(this.useUnsafeEvaluator=!1,t.intrinsics.eval):n in r?Q(r,n,o):Q(o,n)},set(t,e,n){if(e in r){return\\"value\\"in V(r,e)?X(r,e,n):X(r,e,n,o)}return X(o,e,n)},has:(t,n)=>!!(e||\\"eval\\"===n||n in r||n in o||n in globalThis),getPrototypeOf:()=>null}}(t,r,c.endowments,{sloppyGlobalsMode:i}),s=tt(ft,p),y=Tt(t,function(t,o={}){const r=z(t),e=z(o),n=e.filter(t=>ht(t)&&At(o,t));return[...r.filter(o=>!e.includes(o)&&ht(o)&&At(t,o)),...n]}(r,c.endowments)),l=K(y,s.proxy,[]);let u;p.useUnsafeEvaluator=!0;try{return K(l,r,[c.src])}catch(t){throw u=t,t}finally{!0===p.useUnsafeEvaluator&&(Pt(\\"handler did not revoke useUnsafeEvaluator\\",u),s.revoke())}}const Ot=(t,o,r={})=>{const e=e=>\\"string\\"!=typeof e?e:vt(t,e,o,{},r);return W(e,{toString:{value:()=>\\"function eval() { [native code] }\\",writable:!1,enumerable:!1,configurable:!0}}),bt(gt(e)!==Function,\\"eval constructor is Function\\"),bt(gt(e)!==t.intrinsics.Function,\\"eval contructions is %Function%\\"),e};function Ut(t,o,r={}){const e=function(e){const n=`${ct(arguments)||\\"\\"}`,a=`${it(arguments,\\",\\")}`;new t.intrinsics.Function(a,n);const i=`(function anonymous(${a}\\\\n) {\\\\n${n}\\\\n})`;return vt(t,i,o,{},r)};return W(e,{prototype:{value:t.intrinsics.Function.prototype,writable:!1,enumerable:!1,configurable:!1},toString:{value:()=>\\"function Function() { [native code] }\\",writable:!1,enumerable:!1,configurable:!0}}),bt(Y(Function)===Function.prototype),bt(Y(e)===Function.prototype),bt(gt(e)!==Function),bt(gt(e)!==t.intrinsics.Function),e}const xt=[\\"eval\\",\\"isFinite\\",\\"isNaN\\",\\"parseFloat\\",\\"parseInt\\",\\"decodeURI\\",\\"decodeURIComponent\\",\\"encodeURI\\",\\"encodeURIComponent\\",\\"Array\\",\\"ArrayBuffer\\",\\"Boolean\\",\\"DataView\\",\\"Date\\",\\"Error\\",\\"EvalError\\",\\"Float32Array\\",\\"Float64Array\\",\\"Function\\",\\"Int8Array\\",\\"Int16Array\\",\\"Int32Array\\",\\"Map\\",\\"Number\\",\\"Object\\",\\"Promise\\",\\"Proxy\\",\\"RangeError\\",\\"ReferenceError\\",\\"RegExp\\",\\"Set\\",\\"String\\",\\"Symbol\\",\\"SyntaxError\\",\\"TypeError\\",\\"Uint8Array\\",\\"Uint8ClampedArray\\",\\"Uint16Array\\",\\"Uint32Array\\",\\"URIError\\",\\"WeakMap\\",\\"WeakSet\\",\\"JSON\\",\\"Math\\",\\"Reflect\\",\\"escape\\",\\"unescape\\",\\"globalThis\\",\\"Compartment\\",\\"harden\\"];const{getOwnPropertyDescriptor:Rt}=Object,Ct=[\\"eval\\",\\"isFinite\\",\\"isNaN\\",\\"parseFloat\\",\\"parseInt\\",\\"decodeURI\\",\\"decodeURIComponent\\",\\"encodeURI\\",\\"encodeURIComponent\\",\\"Array\\",\\"ArrayBuffer\\",\\"Boolean\\",\\"DataView\\",\\"Date\\",\\"Error\\",\\"EvalError\\",\\"Float32Array\\",\\"Float64Array\\",\\"Function\\",\\"Int8Array\\",\\"Int16Array\\",\\"Int32Array\\",\\"Map\\",\\"Number\\",\\"Object\\",\\"Promise\\",\\"Proxy\\",\\"RangeError\\",\\"ReferenceError\\",\\"RegExp\\",\\"Set\\",\\"String\\",\\"Symbol\\",\\"SyntaxError\\",\\"TypeError\\",\\"Uint8Array\\",\\"Uint8ClampedArray\\",\\"Uint16Array\\",\\"Uint32Array\\",\\"URIError\\",\\"WeakMap\\",\\"WeakSet\\",\\"JSON\\",\\"Math\\",\\"Reflect\\",\\"escape\\",\\"unescape\\",\\"globalThis\\",\\"Compartment\\",\\"harden\\"];let Mt;function jt(){if(Mt)return Mt;const t=function(){const t={__proto__:null};for(const o of Ct){const r=Rt(globalThis,o);if(r){if(\\"get\\"in r||\\"set\\"in r)throw new TypeError(`Unexpected accessor on global property: ${o}`);t[o]=r.value}}return t}();return Mt={__proto__:null,intrinsics:t},L(Mt)}const Gt=new WeakMap;class kt{constructor(t,o,r={}){const{transforms:e=[]}=r,n=[...e],a=function(t,{globalTransforms:o}){const r={},e={Infinity:{value:1/0,enumerable:!1},NaN:{value:NaN,enumerable:!1},undefined:{value:void 0,enumerable:!1}};for(const n of xt){if(!at(t.intrinsics,n))continue;let a;switch(n){case\\"eval\\":a=Ot(t,r,{globalTransforms:o});break;case\\"Function\\":a=Ut(t,r,{globalTransforms:o});break;case\\"globalThis\\":a=r;break;default:a=t.intrinsics[n]}e[n]={value:a,configurable:!0,writable:!0,enumerable:!1}}return W(r,e),bt(r.eval!==t.intrinsics.eval,\\"eval on global object\\"),bt(r.Function!==t.intrinsics.Function,\\"Function on global object\\"),r}(jt(),{globalTransforms:n});B(a,t),Gt.set(this,{globalTransforms:n,globalObject:a})}get global(){return Gt.get(this).globalObject}evaluate(t,o={}){if(\\"string\\"!=typeof t)throw new TypeError(\\"first argument of evaluate() must be a string\\");const{endowments:r={},transforms:e=[],sloppyGlobalsMode:n=!1}=o,a=[...e],{globalTransforms:i,globalObject:c}=Gt.get(this);return vt(jt(),t,c,r,{globalTransforms:i,localTransforms:a,sloppyGlobalsMode:n})}toString(){return\\"[object Compartment]\\"}static toString(){return\\"function Compartment() { [shim code] }\\"}}let Nt;function $t(t,o){if(!t)throw new TypeError(o)}\\"object\\"!=typeof globalThis&&(Object.prototype.__defineGetter__(\\"__magic__\\",(function(){return this})),__magic__.globalThis=__magic__,delete Object.prototype.__magic__),t.lockdown=function(t={}){const{noTameDate:o=!1,noTameError:r=!1,noTameMath:e=!1,noTameRegExp:n=!1,registerOnly:a=!1,...i}=t,c=Object.keys(i);$t(0===c.length,`lockdown(): non supported option ${c.join(\\", \\")}`);const p={noTameDate:o,noTameError:r,noTameMath:e,noTameRegExp:n,registerOnly:a};if(Nt)return Object.keys(p).forEach(t=>{$t(p[t]===Nt[t],`lockdown(): cannot re-invoke with different option ${t}`)}),!1;Nt=p,function(){try{(0,Function.prototype.constructor)(\\"return 1\\")}catch(t){return}const{defineProperties:t,getPrototypeOf:o,setPrototypeOf:r}=Object;function e(e,n){let a;try{a=(0,eval)(n)}catch(t){if(t instanceof SyntaxError)return;throw t}const i=o(a),c=function(){throw new TypeError(\\"Not available\\")};t(c,{name:{value:e,writable:!1,enumerable:!1,configurable:!0},toString:{value:()=>`function ${e}() { [native code] }`,writable:!1,enumerable:!1,configurable:!0}}),t(i,{constructor:{value:c}}),t(c,{prototype:{value:i}}),c!==Function.prototype.constructor&&r(c,Function.prototype.constructor)}e(\\"Function\\",\\"(function(){})\\"),e(\\"GeneratorFunction\\",\\"(function*(){})\\"),e(\\"AsyncFunction\\",\\"(async function(){})\\"),e(\\"AsyncGeneratorFunction\\",\\"(async function*(){})\\")}(),o||function(){const t={now:()=>NaN};Date.now=t.now;const o={toLocaleString:()=>NaN};Date.prototype.toLocaleString=o.toLocaleString;const r=Date,e=function(){return void 0===new.target?\\"Invalid Date\\":arguments.length>0?Reflect.construct(r,arguments,new.target):Reflect.construct(r,[NaN],new.target)},n=v(r);T(e,n);const a=v(r.prototype);a.constructor.value=e,T(e.prototype,a),globalThis.Date=e;const i={toLocaleString(){throw new TypeError(\\"Object.prototype.toLocaleString is disabled\\")}};Object.prototype.toLocaleString=i.toLocaleString}(),r||function(){if(delete Error.captureStackTrace,O(Error,\\"captureStackTrace\\"))throw Error(\\"Cannot remove Error.captureStackTrace\\");if(delete Error.stackTraceLimit,O(Error,\\"stackTraceLimit\\"))throw Error(\\"Cannot remove Error.stackTraceLimit\\")}(),e||function(){const t={random(){throw TypeError(\\"Math.random() is disabled\\")}};Math.random=t.random}(),n||function(){delete RegExp.prototype.compile;const t=RegExp,o=function(){return Reflect.construct(t,arguments,new.target)},r=R(t,Symbol.species);U(o,Symbol.species,r);const e=x(t.prototype);e.constructor.value=o,U(o.prototype,e),globalThis.RegExp=o}();const s=function(t,o={}){const{freeze:r,getOwnPropertyDescriptors:e,getPrototypeOf:n}=Object,{ownKeys:a}=Reflect;let{fringeSet:i}=o;if(i){if(\\"function\\"!=typeof i.add||\\"function\\"!=typeof i.has)throw new TypeError(\\"options.fringeSet must have add() and has() methods\\");if(t)for(const o of t)i.add(o)}else i=new WeakSet(t);const c=o&&o.naivePrepareObject,{harden:p}={harden(t){const o=new Set,p=new Map,s=new WeakMap;function y(t,r){if(Object(t)!==t)return;const e=typeof t;if(\\"object\\"!==e&&\\"function\\"!==e)throw new TypeError(`Unexpected typeof: ${e}`);i.has(t)||o.has(t)||(o.add(t),s.set(t,r))}function l(t){c&&c(t),r(t);const o=n(t),i=e(t),l=s.get(t)||\\"unknown\\";null===o||p.has(o)||(p.set(o,l),s.set(o,`${l}.__proto__`)),a(i).forEach(t=>{const o=`${l}.${String(t)}`,r=i[t];\\"value\\"in r?y(r.value,`${o}`):(y(r.get,`${o}(get)`),y(r.set,`${o}(set)`))})}return y(t),o.forEach(l),p.forEach((t,r)=>{if(!o.has(r)&&!i.has(r)){let o;try{o=`prototype ${r} of ${t} is not already in the fringeSet`}catch(e){o=\\"a prototype of something is not already in the fringeset (and .toString failed)\\";try{console.log(o),console.log(\\"the prototype:\\",r),console.log(\\"of something:\\",t)}catch(t){}}throw new TypeError(o)}}),o.forEach(i.add,i),t}};return p}();Object.defineProperties(globalThis,{harden:{value:s,configurable:!0,writable:!0,enumerable:!1},Compartment:{value:kt,configurable:!0,writable:!0,enumerable:!1}});const y=l();F(y),function(){try{(0,Object.prototype.__lookupGetter__)(\\"x\\")}catch(t){return}const{defineProperty:t,defineProperties:o,getOwnPropertyDescriptor:r,getPrototypeOf:e,prototype:n}=Object;function a(t){if(null==t)throw new TypeError(\\"can\'t convert undefined or null to object\\");return Object(t)}function i(t){return\\"symbol\\"==typeof t?t:`${t}`}function c(t,o){if(\\"function\\"!=typeof t)throw TypeError(`invalid ${o} usage`);return t}o(n,{__defineGetter__:{value:function(o,r){const e=a(this);t(e,o,{get:c(r,\\"getter\\"),enumerable:!0,configurable:!0})}},__defineSetter__:{value:function(o,r){const e=a(this);t(e,o,{set:c(r,\\"setter\\"),enumerable:!0,configurable:!0})}},__lookupGetter__:{value:function(t){let o,n=a(this);for(t=i(t);n&&!(o=r(n,t));)n=e(n);return o&&o.get}},__lookupSetter__:{value:function(t){let o,n=a(this);for(t=i(t);n&&!(o=r(n,t));)n=e(n);return o&&o.set}}})}();const u=function(t){const o={};function r(t,r,e,n){if(\\"value\\"in n&&n.configurable){const{value:a}=n;o[t]=a,j(r,{[e]:{get:function(){return a},set:function(o){if(r===this)throw new TypeError(`Cannot assign to read only property \'${e}\' of \'${t}\'`);hasOwnProperty.call(this,e)?this[e]=o:j(this,{[e]:{value:o,writable:!0,enumerable:n.enumerable,configurable:n.configurable}})},enumerable:n.enumerable,configurable:n.configurable}})}}function e(t,o,e){const n=k(o,e);n&&r(t,o,e,n)}function n(t,o){const e=N(o);e&&$(e).forEach(n=>r(t,o,n,e[n]))}return function t(o,r,a){for(const i of G(a)){const c=k(r,i);if(!c||c.get||c.set)continue;const p=`${o}.${i}`,s=a[i];if(!0===s)e(p,r,i);else if(\\"*\\"===s)n(p,c.value);else{if(!D(s))throw new TypeError(`Unexpected override enablement plan ${p}`);t(p,c.value,s)}}}(\\"root\\",t,M),o}(y);return s(y,a),s(u,a),!0},Object.defineProperty(t,\\"__esModule\\",{value:!0})}));\\n"')},function(t,e){t.exports={makeDeterministic:function(){const t=(t,e)=>{if(t===e)return 0;if(void 0===t)return 1;if(void 0===e)return-1;const r=null===t?"null":t.toString(),n=null===e?"null":e.toString();return r<n?-1:r>n?1:0},e=Array.prototype.sort;Array.prototype.sort=function(r=t){const n=new Map;return this.forEach((t,e)=>n.set(t,e)),e.call(this,(t,e)=>{const o=r(t,e);return 0!==o?o:n.get(t)-n.get(e)})},delete String.prototype.localeCompare;const r=Function.prototype.toString;Function.prototype.toString=function(){const t=r.call(this),e=t.match(/^([a-zA-Z0-9_$]+)\s*\(/);return e&&"function"!==e[1]?"function "+t:t}},nonDeterministicIntrinsics:["Date","Math","eval","XMLHttpRequest","FileReader","WebSocket","setTimeout","setInterval"]}},function(t,e){t.exports=r(26)}])},function(t,e){t.exports=require("vm")},function(t,e,r){const{JigControl}=r(3),{j:n,k:o}=r(0),{te:i}=r(9),s=r(28),c=r(1),a=r(5);t.exports=class{constructor(t){this.Tt=t,this.vr=[],this.Ze=new Map,this.Sr=[],this.Ar=new s}xr(t){if(!t.Ie()){for(const[e,r]of t.Oe)this.Ze.has(e)||this.Ze.set(e,r);this.vr.push(t),1===this.vr.length&&this.Ir().catch(t=>{})}}async ir(){if(this.vr.length)return new Promise((t,e)=>{this.Sr.push({resolve:t,reject:e})})}async Ir(){const t=this.vr[0];let e=null;try{e=await this.Tr(t)}catch(t){return void this.jr(t)}this.$r(t,e),await this.Rr(t,e),this.kr(t),this.vr.shift(),this.vr.length?this.Ir().catch(t=>{}):(this.Sr.forEach(t=>t.resolve()),this.Sr=[])}async Tr(t){const e=t.We(this.Tt);let r=null;const{refs:n,Me:o,Ce:i}=e;r=e.tx;const s=n.map(t=>t.slice(0,64)),a=n.map(t=>parseInt(t.slice(66)));(s.length?await Promise.all(s.map(t=>this.Tt.je.fetch(t))):[]).forEach((t,e)=>{if(void 0===t.outputs[a[e]].spentTxId)throw new Error(`Read ${n[e]} may not be latest. Blockchain did not return spentTxId. Aborting.`);if(null!==t.outputs[a[e]].spentTxId)throw new Error(`Read ${n[e]} is not the latest. Must sync() jigs`)}),t.Se||await t.Ve(this.Tt),await t.ze(this.Tt),r=t.We(this.Tt).tx;for(let t=0;t<o.length;t++)if(!r.inputs[t].isFullySigned()){const e=`${"origin: "+o[t].origin}\n${"location: "+i[t]}\n${"owner: "+o[t].owner}`,n=r.inputs[t].script.toBuffer().length?"Bad signature":"Missing signature";throw new Error(`${n} for ${o[t].constructor.name}\n\n${e}`)}if("function"==typeof this.Tt.Ke.broadcast)try{await this.Tt.Ke.broadcast(r.toString("hex"))}catch(t){c.ut("Publisher",t.toString())}try{await this.Tt.je.broadcast(r)}catch(t){throw await this.Fr(t,r)}return this.Ar.Ur(r),r}async Fr(t,e){const r=t.toString();let n="Broadcast failed: "+t.message;if(-1!==r.indexOf("tx has no inputs")||-1!==r.indexOf("tx fee too low")){n=`${n}\n\n${"Hint: Is the purse funded to pay for this transaction?"}`}if(-1!==r.indexOf("Missing inputs")||-1!==r.indexOf("txn-mempool-conflict"))for(const r of e.inputs){const e=r.prevTxId.toString("hex");let o=null;try{o=await this.Tt.je.fetch(e,!0)}catch(t){continue}const s=o.outputs[r.outputIndex];if(s.spentTxId){const c=`${e}_o${r.outputIndex}`;let a="Payment";switch(i(o,r.outputIndex)){case"code":try{a=(await this.Tt.or(c)).name}catch(t){a="Code"}break;case"jig":try{a=""+await this.Tt.or(c)}catch(t){a="Jig"}}n=`${n}\n\n${a} was spent in another transaction\n`,n=`${n}\nLocation: ${c}`,n=`${n}\nSpending Tx: ${s.spentTxId}`}}return new Error(n)}$r(t,e){const r=t=>this.vr.slice(1).some(e=>e.Pe.some(e=>o(t,e)));t.Pe.forEach((n,o)=>{const i=1+t.we.length+o;"_"===n.origin[0]&&(n.origin=`${e.hash}_o${i}`),r(n)?this.Ze.set(n.origin,`${e.hash}_o${i}`):(n.location=`${e.hash}_o${i}`,this.Ze.delete(n.origin)),t._e.get(n).restore().origin=n.origin,t._e.get(n).restore().location=`${e.hash}_o${i}`}),t.we.forEach((t,r)=>t.success(`${e.hash}_o${r+1}`))}async Rr(t,e){for(const r of t.Pe){const o=t._e.get(r).restore(),i=o.location;o.origin.startsWith(e.hash)&&delete o.origin,o.location.startsWith(e.hash)&&delete o.location;const s=JigControl.g(()=>a.et(o,{W:a.K.Ct(a.K.q(a.K.Y(t=>{const r=this.Ze.get(t.origin)||t.location;return r.startsWith(e.hash)?r.slice(64):r}),a.K.X()))})),c=n(this.Tt.je.network);let u=r.constructor["origin"+c];u.startsWith(e.hash)&&(u=u.slice(64));const f={type:u,state:s};await this.Tt.Ue.set(i,f)}}kr(t){const e=this.Tt.De;t.we.forEach(t=>e.Be(t.S)),t.Pe.forEach(r=>e.Be(t.dt.get(r)))}jr(t){const e=0===this.Sr.length,r=[];for(let n=this.vr.length-1;n>=0;n--)try{this.vr[n].He(this.Ze,this.Tt,t,e)}catch(t){r.push(t)}let n=t.toString();r.length&&(n+="These errors also occurred while rolling back:",r.forEach(t=>{n+="\n\n"+t.toString()}));const o=new Error(n);e&&c.ut("Publisher","Unhandled",o),this.Sr.forEach(t=>t.reject(o)),this.Sr=[],this.vr=[],this.Ze=new Map}}},function(t,e){class r{constructor(t){this.Nr=t}Mr(){this.Nr.Cr.delete(this)}}t.exports=class{constructor(){this.Cr=new Map}Ur(t){for(const e of this.Cr.values())e(t)}Br(t){const e=new r(this);return this.Cr.set(e,t),e}}},function(t,e,r){const n=r(19),{JigControl}=r(3),o=r(6),{C:i,R:s}=r(0),c=r(1);t.exports=class{constructor(t){this.Tt=t}async xt(t,e){c.ct("Syncer","Syncing");const r=void 0===e||e,n=new Set,o=this.Tt.Xe,i=o.Ar.Br(t=>n.add(t.hash));try{await o.ir()}catch(e){if(r)try{await this.Dr(t,n)}catch(t){}throw e}finally{i.Mr()}return r&&await this.Dr(t,n),t}async Dr(t,e=new Set,r=new Map){const n=r.get(t.origin);if(n)return JigControl.g(()=>JigControl.$t(()=>{Object.assign(t,n)}));let i=o.parse(t.location),s=await this.Tt.je.fetch(i.txid,!e.has(i.txid));for(e.add(i.txid);null!==s.outputs[i.vout].spentTxId;)s=await this.Lr(s,i.vout,e),await this.Gr(t,s),i=o.parse(t.location);return r.set(t.origin,t),await this.Hr(t,e,r),t}async Lr(t,e,r){const n=t.outputs[e];if(void 0===n.spentTxId){throw new Error(`${"Failed to forward sync jig"}\n\n${"The blockchain API does not support the spentTxId field."}\n\n${"Hint: To just publish updates without forward sync, use `jig.sync({ forward: false })`."}`)}const o=await this.Tt.je.fetch(n.spentTxId,!r.has(n.spentTxId));if(r.add(n.spentTxId),!o.inputs.some(r=>r.prevTxId.toString("hex")===t.hash&&r.outputIndex===e)){const e="Blockchain API returned an incorrect spentTxId",r=`Txid: ${t.hash}\nSpent Txid: ${n.spentTxId}`;throw new Error(`${e}\n\n${r}\n\n${"Hint: Check that the blockchain API is working correctly"}`)}return o}async Gr(t,e){const r=new n;if(await r.Te(e,this.Tt,t,!0),!Array.from(r.dt.values()).some(e=>e===t)){const r="Expected but did not find a jig in its spent transaction",n=`Jig origin: ${t.origin}\nTxid: ${e.hash}`;throw new Error(`${r}\n\n${n}\n\n${"This is an internal Run bug. Please report it to the library developers."}`)}}async Hr(t,e,r){const n=[];JigControl.g(()=>{i(t,t=>("jig"===s(t)&&n.push(t),!0))});for(const t of n)await this.Dr(t,e,r)}}},function(t,e,r){const n=r(2),{JigControl}=r(3),{ResourceSet:o,Qt:i}=r(8),{R:s,L:c,F:a}=r(0),u=r(1),f="Inventory";function l(t){return JigControl.g(()=>{try{return"!"===t.location[0]}catch(t){return!0}})}t.exports=class{constructor(t){this.Tt=t,this.Qe=t.Qe,this.Jr=null,this.Y=new o}get jigs(){return this.resources.filter(t=>"jig"===s(t))}get code(){return this.resources.filter(t=>"code"===s(t))}get resources(){const t=[],e=[];for(const r of this.Y.values())l(r)||!this.Vr(r)?e.push(r):t.push(r);return i(()=>{e.forEach(t=>{this.Y.delete(t)&&u.ct(f,"Removed",a(t))})}),t}async sync(){return this.Jr||(this.Jr=this.Wr().then(()=>{this.Jr=null}).catch(t=>{throw this.Jr=null,t})),this.Jr}async Wr(){const t=[],e=this.Qe.owner(),r=(Array.isArray(e)?e:[e]).map(async e=>{const r=new n.Script(n.deps.Buffer.from(c(e).script()));(await this.Tt.je.utxos(r)).forEach(e=>t.push(`${e.txid}_o${e.vout}`))});await Promise.all(r);const o=new Set(t),s=[],h=[];JigControl.g(()=>{for(const t of this.Y.values())t.location.startsWith("_")?h.push(t):l(t)||!this.Vr(t)?s.push(t):o.has(t.location)?h.push(t):s.push(t)}),i(()=>{s.forEach(t=>{this.Y.delete(t)&&u.ct(f,"Removed",a(t))})});const p=new Set(JigControl.g(()=>h.map(t=>t.location)));for(const e of t){if(p.has(e))continue;let t=null;try{t=await this.Tt.or(e)}catch(t){u.at(f,`Failed to load owner location ${e}\n\n${t.toString()}`);continue}i(()=>{const e=this.Y.has(t);this.Y.add(t),e||u.ct(f,"Added",a(t))})}}Be(t){i(()=>{const e=this.Y.has(t);this.Y.delete(t),this.Vr(t)?(this.Y.add(t),e||u.ct(f,"Added",a(t))):e&&u.ct(f,"Removed",a(t))})}Vr(t){try{const e=this.Qe.owner(),r=(Array.isArray(e)?e:[e]).map(t=>c(t)),n=c(t.owner);return r.some(t=>function(t,e){const r=t.script(),n=e.script();if(r.length!==n.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==n[t])return!1;return!0}(t,n))}catch(t){return!1}}}},function(t,e,r){const{JigControl}=r(3),n=r(6),{ie:o}=r(10),i=r(5),s=r(1),c=r(19),{A:a}=r(0),{te:u}=r(9),f="Transaction";t.exports=class{constructor(t){this.Tt=t,this.qr=new c(this.ge.bind(this)),this.Kr=null,this.Yr=null}get zr(){return this.Kr||this.qr}fe(){if(this.Yr)return this.Yr;const t=this.Tt.Qe.owner();return Array.isArray(t)?t[0]:t}ke(t,e){this.Kr=t,this.Yr=e}Fe(){this.Kr=null,this.Yr=null}begin(){return this.zr.Le(),a()}end(){return this.zr.Ge(),a()}ge(){this.Kr||(this.Tt.Xe.xr(this.qr),this.qr=new c(this.ge.bind(this)))}export(){if(this.Tt.Xe.vr.length>0)throw new Error("must not have any queued transactions before exporting");if(0===this.qr.Ee){throw new Error("No transaction in progress\n\n"+"Hint: A transaction must first be created using begin() or loaded using import().")}return this.qr.We(this.Tt).tx}import(t){return s.ct(f,"Importing",t.hash),this.qr.Te(t,this.Tt,null,!1)}rollback(){s.ct(f,"Rollback"),this.qr.He(this.Tt.Xe.Ze,this.Tt,"intentional rollback",!1)}async sign(){await this.qr.ze(this.Tt)}async pay(){await this.qr.Ve(this.Tt)}get actions(){return this.qr.be.map(t=>({target:this.qr.dt.get(t.target),method:t.method,args:t.args}))}Ne(t,e,r,n,o,i){return this.zr.Ne(t,e,r,n,o,i,this.fe(),this.Tt.we,this.Tt)}St(t,e,r,n,o,i,s,c,a){this.zr.St(t,e,r,n,o,i,s,c,a,this.Tt)}async load(t,e={}){if(s.ct(f,"Loading",t),e.ne)return o(t,this.Tt.je,this.Tt.we,e.ne);const r=n.parse(t);if(r.innerLocation){const t=await this.load(r.location,e);return o(r.innerLocation,this.Tt.je,this.Tt.we,t)}return this.Qr(t,e)}async Qr(t,e={}){const r=e.cachedRefs||new Map,o=this.Tt.we.jt(t);if(o)return o;if(e.Er&&e.Er.has(t))return e.Er.get(t);const s=n.parse(t);if(s.error||s.innerLocation||s.vref||s.tempTxid)throw new Error("Bad location: "+t);const{txid:a,vout:f,vin:l}=s;if(void 0!==l){const t=await this.Tt.je.fetch(a),e=t.inputs[l].prevTxId.toString("hex");return this.load(`${e}_o${t.inputs[l].outputIndex}`,{cachedRefs:r})}const h=await this.Tt.Ue.get(t);if(h){if("string"!=typeof h.type||"object"!=typeof h.state){const t="Hint: Could the state cache be corrupted?";throw new Error(`Cached state is missing a valid type and/or state property\n\n${JSON.stringify(h)}\n\n${t}`)}const e=e=>e.startsWith("_")?`${t.slice(0,64)}${e}`:e,n=t=>r.get(e(t));try{JigControl.Ot=!0;const o=h.type.startsWith("_")?t.slice(0,64)+h.type:h.type,s=new(await this.load(o));r.set(t,s);const c=i.Ht(h.state);for(const t of c){const n=e(t);if(r.has(n))continue;const o=await this.load(n,{cachedRefs:r});r.has(n)||r.set(n,o)}return JigControl.g(()=>{const e=i.rt(h.state,{ot:this.Tt.we.ot,Z:i.tt.q(i.tt.Y(n),i.tt.X())});Object.assign(s,e),s.origin=s.origin||t,s.location=s.location||t}),s}finally{JigControl.Ot=!1}}const p=await this.Tt.je.fetch(a),y=u(p,f);if("jig"!==y&&"code"!==y)throw new Error("Not a token: "+t);const g=new c;if(await g.Te(p,this.Tt,null,!0,f,e.Er),f>0&&f<g.we.length+1)return this.Tt.we.jt(t)||e.Er.get(t);const d=g.Pe.map(t=>g.dt.get(t)),w=new Array(1+g.we.length).concat(d);if(void 0===w[f])throw new Error("not a jig output");return w[f]}}},function(t,e,r){const{Script:n,Transaction:o}=r(2),{I:i}=r(0),{NotImplementedError}=r(11),{Jt:s,Vt:c}=r(7),a=r(1),u=r(12),f="BlockchainApi";class l{constructor(t={}){this.network=_(t.network),this.Xr=function(t){switch(typeof t.api){case"string":{const e=w[t.api];if(!e)throw new Error("Unknown blockchain API: "+t.api);return new e(t)}case"object":if(!t.api)throw new Error("Invalid blockchain API: "+t.api);return t.api;case"undefined":return"stn"===t.network?new d(t):new y(t);default:throw new Error("Invalid blockchain API: "+t.api)}}(t),this.cache=function(t,e){if(t&&t instanceof l&&t.network===e)return t.cache;return new h}(t.lastBlockchain,this.network),this.bsvNetwork=i(this.network),this.Zr=new Map}get api(){return"string"==typeof this.Xr.api?this.Xr.api:"custom"}async broadcast(t){if(await s(t,this),t.lock&&t.lock(),0===t.inputs.length)throw new Error("tx has no inputs");if(0===t.outputs.length)throw new Error("tx has no outputs");if(t.getFee()<t.toBuffer().length*o.FEE_PER_KB/1e3)throw new Error("tx fee too low");if(!0!==t.verify())throw new Error(t.verify());if(!0!==t.isFullySigned())throw new Error("tx not fully signed");if(t.inputs.some((e,r)=>!t.isValidSignature({inputIndex:r})))throw new Error("tx signature not valid");t.time=Date.now(),t.confirmations=0,t.outputs.forEach(t=>{t.spentTxId=null,t.spentIndex=null,t.spentHeight=null}),await this.Xr.broadcast(t),this.cache.tn(t)}async fetch(t,e=!1){const r=this.cache.ce(t);if(!e&&r)return r;const n=this.Zr.get(t);if(n)return new Promise((t,e)=>n.push({resolve:t,reject:e}));this.Zr.set(t,[]);try{const e=await this.Xr.fetch(t,!0);if(r)for(let t=0;t<e.outputs.length;t++)e.outputs[t].spentTxId=e.outputs[t].spentTxId||r.outputs[t].spentTxId,e.outputs[t].spentIndex=e.outputs[t].spentIndex||r.outputs[t].spentIndex,e.outputs[t].spentHeight=e.outputs[t].spentHeight||r.outputs[t].spentHeight;return this.cache.en(e),this.Zr.get(t).forEach(t=>t.resolve(e)),e}catch(e){throw this.Zr.get(t).forEach(t=>t.reject(e)),e}finally{this.Zr.delete(t)}}async utxos(t){const e=t instanceof n?t:n.fromAddress(t),r=c(e),o=this.Zr.get(r);if(o)return new Promise((t,e)=>o.push({resolve:t,reject:e}));this.Zr.set(r,[]);try{const n=await this.Xr.utxos(e);if(!Array.isArray(n))throw new Error(`Received invalid utxos for ${t}\n\n: Type: ${typeof n}\n\nNetwork: ${this.network}`);const o=this.rn(n),i=this.cache.nn(o,e);return this.Zr.get(r).forEach(t=>t.resolve(i)),i}catch(t){throw this.Zr.get(r).forEach(e=>e.reject(t)),t}finally{this.Zr.delete(r)}}rn(t){const e=new Set;return t.filter(t=>{const r=`${t.txid}_o${t.vout}`;return e.has(r)?(a.at(f,"Duplicate utxo returned from server:",r),!1):(e.add(r),!0)})}}class h{constructor(){this.sn=new Map,this.Ar=[],this.size=1e4,this.expiration=6e5,this.cn=1e4}clear(){this.sn=new Map,this.Ar=[]}ce(t){const e=this.sn.get(t);if(e)return Date.now()-e.an>this.expiration?void this.sn.delete(t):(this.sn.delete(t),this.sn.set(t,e),e)}en(t){if(t.an=Date.now(),this.sn.set(t.hash,t),this.sn.size>this.size){const t=this.sn.keys().next().value;this.sn.delete(t)}}tn(t){this.en(t);const e=Date.now();this.Ar=this.Ar.filter(t=>e-t.time<this.cn),this.Ar.push(t),t.inputs.forEach((e,r)=>{const n=this.sn.get(e.prevTxId.toString("hex"));n&&(n.outputs[e.outputIndex].spentTxId=t.hash,n.outputs[e.outputIndex].spentIndex=r,n.outputs[e.outputIndex].spentHeight=-1)})}nn(t,e){const r=Date.now();return this.Ar=this.Ar.filter(t=>r-t.time<this.cn),this.Ar.forEach(r=>{r.outputs.forEach((n,o)=>{n.script.equals(e)&&!t.some(t=>t.txid===r.hash&&t.vout===o)&&t.push({txid:r.hash,vout:o,script:n.script,satoshis:n.satoshis})})}),this.Ar.forEach(e=>{t=t.filter(t=>!e.inputs.some(e=>((t,e)=>t.prevTxId.toString("hex")===e.txid&&t.outputIndex===e.vout)(e,t)))}),t}}class p{constructor(t={}){this.timeout=function(t){switch(typeof t){case"number":if(Number.isNaN(t)||t<0)throw new Error("Invalid timeout: "+t);return t;case"undefined":return 1e4;default:throw new Error("Invalid timeout: "+t)}}(t.timeout),this.network=t.network,this.apiKey=t.apiKey}async broadcast(t){await u.ue(this.un(this.network),this.fn(t),this.timeout)}async fetch(t,e=!1){const r=await u.ce(this.ln(this.network,t),this.timeout);return this.hn(r)}async utxos(t){const e=await u.ce(this.pn(this.network,t),this.timeout);return this.yn(e,t)}get api(){return"custom"}un(t){throw new NotImplementedError}fn(t){throw new NotImplementedError}ln(t,e){throw new NotImplementedError}hn(t){throw new NotImplementedError}pn(t,e){throw new NotImplementedError}yn(t,e){throw new NotImplementedError}}class y extends p{constructor(t){if(t.network=_(t.network),"main"!==t.network&&"test"!==t.network)throw new Error("Run Connect API only supports mainnet and testnet");super(t)}get api(){return"run"}un(t){return`https://api.run.network/v1/${t}/tx`}fn(t){return{rawtx:t.toString("hex")}}ln(t,e){return`https://api.run.network/v1/${t}/tx/${e}`}hn(t){return b(t)}pn(t,e){return`https://api.run.network/v1/${t}/utxos/${c(e)}`}yn(t,e){return"string"==typeof t?JSON.parse(t):t}}class g extends p{constructor(t){if(t.network=_(t.network),"main"!==t.network)throw new Error("MatterCloud API only supports mainnet");super(t)}get api(){return"mattercloud"}un(t){return`https://api.mattercloud.net/api/v3/${t}/tx/send${this.gn}`}fn(t){return{rawtx:t.toString("hex")}}ln(t,e){return`https://api.mattercloud.net/api/v3/${t}/tx/${e}${this.gn}`}hn(t){const e=b(t);return e.confirmations=e.confirmations||0,e}pn(t,e){return`https://api.mattercloud.net/api/v3/${t}/scripthash/${c(e)}/utxo${this.gn}`}yn(t,e){return t.map(t=>Object.assign({},t,{script:e}))}get gn(){return this.apiKey?"?api_key="+this.apiKey:""}}class d extends p{constructor(t){if(t.network=_(t.network),"main"!==t.network&&"test"!==t.network&&"stn"!==t.network)throw new Error("WhatsOnChain API only supports mainnet, testnet, and STN");super(t)}get api(){return"whatsonchain"}un(t){return`https://api.whatsonchain.com/v1/bsv/${t}/tx/raw`}fn(t){return{txhex:t.toString("hex")}}pn(t,e){return`https://api.whatsonchain.com/v1/bsv/${t}/script/${c(e)}/unspent`}yn(t,e){return t.map(t=>({txid:t.tx_hash,vout:t.tx_pos,satoshis:t.value,script:e}))}async fetch(t,e=!1){const r=`https://api.whatsonchain.com/v1/bsv/${this.network}/tx/hash/${t}`,n=`https://api.whatsonchain.com/v1/bsv/${this.network}/tx/${t}/hex`,[o,i]=await Promise.all([u.ce(r,this.timeout),u.ce(n,this.timeout)]);return o.confirmations=o.confirmations||0,o.hex=i,b(o)}async utxos(t){return"stn"===this.network?(a.at(f,"Utxos are not available on STN"),[]):super.utxos(t)}}const w={run:y,mattercloud:g,bitindex:g,whatsonchain:d};function b(t){if("object"!=typeof t)throw new Error("JSON returned is invalid or not an object: "+t);const e=new o(t.hex||t.rawtx);return e.time=1e3*t.time||Date.now(),t.blockhash&&t.blockhash.length&&(e.blockhash=t.blockhash),t.blocktime&&(e.blocktime=t.blocktime),t.blockheight&&(e.blockheight=t.blockheight),void 0!==t.confirmations&&(e.confirmations=t.confirmations),t.vout&&t.vout.forEach((t,r)=>{void 0!==t.spentTxId&&(e.outputs[r].spentTxId=t.spentTxId),void 0!==t.spentIndex&&(e.outputs[r].spentIndex=t.spentIndex),void 0!==t.spentHeight&&(e.outputs[r].spentHeight=t.spentHeight)}),e}function _(t){if(void 0===t)return"main";if("main"===t||"test"===t||"stn"===t)return t;throw new Error("Unsupported network: "+t)}l.Cache=h,l.RunConnect=y,l.MatterCloud=g,l.WhatsOnChain=d,t.exports=l},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("https")},function(t,e){t.exports=require("zlib")},function(t,e,r){const{PrivateKey:n,Script:o,Transaction:i}=r(2),{I:s,F:c}=r(0),{Jt:a}=r(7);t.exports=class{constructor(t={}){if(this.blockchain=t.blockchain,void 0!==t.privkey&&"string"!=typeof t.privkey&&!(t.privkey instanceof n))throw new Error("Invalid private key: "+c(t.privkey));const e=this.blockchain&&s(this.blockchain.network);if(e&&t.privkey&&t.privkey instanceof n&&t.privkey.network.name!==e)throw new Error("Private key network mismatch");try{this.bsvPrivateKey=new n(t.privkey,e)}catch(e){throw new Error(`Invalid private key: ${c(t.privkey)}\n\n${e}`)}if(t.privkey&&this.bsvPrivateKey.toString()!==t.privkey.toString())throw new Error("Invalid private key: "+c(t.privkey));this.bsvPublicKey=this.bsvPrivateKey.publicKey,this.bsvAddress=this.bsvPublicKey.toAddress(),this.privkey=this.bsvPrivateKey.toString(),this.pubkey=this.bsvPublicKey.toString(),this.address=this.bsvAddress.toString()}async sign(t,e){const r=new i(t);await a(r,this.blockchain);for(let t=0;t<r.inputs.length;t++){const n=e[t]&&e[t].constructor.name;if("StandardLock"===n&&e[t].address===this.address)if(r.signature){const e=r.signature(t,this.bsvPrivateKey).toString("hex"),n=o.fromASM(`${e} ${this.pubkey}`);r.inputs[t].setScript(n)}else r.sign(this.bsvPrivateKey);if("GroupLock"===n&&e[t].pubkeys.includes(this.pubkey)&&r.inputs[t].script.chunks.length<=e[t].m){const e=r.signature(t,this.bsvPrivateKey).toString("hex");let n=null;n=r.inputs[t].script.toBuffer().length?o.fromASM(`${r.inputs[t].script.toASM()} ${e}`):o.fromASM("OP_0 "+e),r.inputs[t].setScript(n)}}return r.toString("hex")}owner(){return this.address}}},function(t,e,r){const{PrivateKey:n,Script:o,Transaction:i}=r(2),{I:s,F:c}=r(0),{te:a}=r(9),{Jt:u}=r(7),f=r(1),l="LocalPurse";function h(t){switch(typeof t){case"number":if(!Number.isInteger(t))throw new Error("splits must be an integer: "+t);if(t<=0)throw new Error("splits must be at least 1: "+t);return t;case"undefined":return 10;default:throw new Error("Invalid splits: "+t)}}function p(t){switch(typeof t){case"number":if(!Number.isFinite(t))throw new Error("feePerKb must be finite: "+t);if(t<0)throw new Error("feePerKb must be non-negative: "+t);return t;case"undefined":return 500;default:throw new Error("Invalid feePerKb: "+t)}}t.exports=class{constructor(t={}){this.blockchain=function(t){switch(typeof t){case"undefined":throw new Error("blockchain is required");case"object":if(t&&t.network)return t}throw new Error("Invalid blockchain: "+c(t))}(t.blockchain),this.dn=h(t.splits),this.wn=p(t.feePerKb),this.bsvPrivateKey=new n(t.privkey,s(this.blockchain.network)),this.privkey=this.bsvPrivateKey.toString(),this.bsvAddress=this.bsvPrivateKey.toAddress(),this.address=this.bsvAddress.toString(),this.script=o.fromAddress(this.bsvAddress)}get splits(){return this.dn}set splits(t){this.dn=h(t)}get feePerKb(){return this.wn}set feePerKb(t){this.wn=p(t)}async pay(t){const e=new i(t);f.ct(l,"Paying for",e.hash);let r=await this.blockchain.utxos(this.script);r=function(t){for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}(r),e.feePerKb(this.feePerKb);const n=this.feePerKb/1e3,s=Math.max(500,e._estimateFee()+e._getOutputAmount());if(!s)return e;if(!r.length){const t=`Hint: Have you funded the purse address ${this.address}?`;throw new Error("Not enough funds\n\n"+t)}let c=s,h=0;await u(e,this.blockchain);const p=e._getInputAmount(),y=e._getOutputAmount();let g=e._getInputAmount(),d=0,w=0;const b=e.inputs.length;if(p-y>=e.toBuffer().length*n)f.ft(l,"Transaction already paid for. Skipping."),p-y>(37+e.toBuffer().length)*n&&e.change(this.bsvAddress);else{for(const t of r){const o=await this.blockchain.fetch(t.txid);if("other"!==a(o,t.vout))continue;e.from(t),h+=t.satoshis,g+=t.satoshis,d+=1,c+=Math.ceil(108*n);const i=this.splits-r.length+d-w;for(let t=0;t<i;t++)c+=Math.ceil(37*n),c+=546,w+=1;if(g>c)break}if(g<=c){const t=`Required ${c} satoshis, ${g} available in ${this.address}`;throw new Error("Not enough funds\n\n"+t)}w<1&&(w=1);const t=c-546*w,o=Math.ceil((h-t)/w);for(let t=0;t<w;t++)t===w-1?e.change(this.bsvAddress):e.to(this.bsvAddress,o)}if(e.signature)for(let t=b;t<e.inputs.length;t++){const r=e.signature(t,this.bsvPrivateKey).toString("hex"),n=this.bsvPrivateKey.publicKey.toString(),i=o.fromASM(`${r} ${n}`);e.inputs[t].setScript(i)}else e.sign(this.bsvPrivateKey);const _=e._getInputAmount()-p-(e._getOutputAmount()-y);return f.ft(l,"Paid about",_,"satoshis,",e.getFee(),"in fees"),e.toString("hex")}async balance(){return(await this.utxos()).reduce((t,e)=>t+e.satoshis,0)}async utxos(){const t=await this.blockchain.utxos(this.script),e=await Promise.all(t.map(t=>this.blockchain.fetch(t.txid)));return t.filter((t,r)=>"other"===a(e[r],t.vout))}}},function(t,e,r){const{L:n,F:o}=r(0),i=r(2),{Script:s}=i,c=r(1);t.exports=class{constructor(t){this.lock=n(t),this.script=new s(i.deps.Buffer.from(this.lock.script()))}async sign(t,e){return c.at("Viewer","Viewer cannot sign ",o(this.lock)),t}owner(){return this.lock}}},function(t,e,r){const n=r(2),{Address:o,Transaction:i,Script:s}=n,c=r(1),{Jt:a,Vt:u}=r(7),{sha256:f}=n.crypto.Hash,l="Mockchain";t.exports=class{constructor(){this.network="mock",this.bn=-1,this.sn=new Map,this._n=new Map,this.mn=new Map,this.Pn=new Set,this.On=new Set,this.En=25}async broadcast(t){if(c.ft(l,"Broadcast",t.hash),await a(t,this),t.lock&&t.lock(),0===t.inputs.length)throw new Error("tx has no inputs");if(0===t.outputs.length)throw new Error("tx has no outputs");if(t.getFee()<t.toBuffer().length*i.FEE_PER_KB/1e3)throw new Error("tx fee too low");if(!0!==t.verify())throw new Error(t.verify());const e=new Set;if(t.inputs.forEach((t,r)=>{const n=`${t.prevTxId.toString("hex")}_o${t.outputIndex}`;if(!this._n.has(n))throw new Error(this.On.has(n)?"txn-mempool-conflict":"Missing inputs");if(e.has(n))throw new Error("already spent input "+r);e.add(n)}),!0!==t.isFullySigned())throw new Error("tx not fully signed");if(t.inputs.some((e,r)=>!t.isValidSignature({inputIndex:r})))throw new Error("tx signature not valid");if(t.vn=Math.max(...t.inputs.map(t=>this.sn.get(t.prevTxId.toString("hex")).vn+1)),t.vn>this.En){throw new Error("too-long-mempool-chain\n\n"+"Hint: Use run.blockchain.block() to produce blocks on the mockchain.")}t.inputs.forEach((t,e)=>{const r=t.prevTxId.toString("hex"),n=`${r}_o${t.outputIndex}`,o=this.sn.get(r).outputs[t.outputIndex].script,i=f(o.toBuffer()).reverse().toString("hex");this._n.delete(n),this.mn.get(i).delete(n)}),t.time=t.time||Date.now(),t.blockheight=-1,t.confirmations=0,this.sn.set(t.hash,t),this.Pn.add(t),t.outputs.forEach(t=>{t.spentTxId=null,t.spentIndex=null,t.spentHeight=null}),t.inputs.forEach((e,r)=>{const n=this.sn.get(e.prevTxId.toString("hex")).outputs[e.outputIndex];n.spentTxId=t.hash,n.spentIndex=r,n.spentHeight=-1,this.On.add(`${e.prevTxId.toString("hex")}_o${e.outputIndex}`)}),t.outputs.forEach((e,r)=>{const n={txid:t.hash,vout:r,script:e.script,satoshis:e.satoshis},o=`${t.hash}_o${r}`;this._n.set(o,n);const i=f(e.script.toBuffer()).reverse().toString("hex"),s=this.mn.get(i)||new Set;s.add(o),this.mn.set(i,s)})}async fetch(t){c.ft(l,"Fetch",t);const e=this.sn.get(t);if(!e)throw new Error("tx not found: "+t);return e}async utxos(t){c.ft(l,"Utxos",t.toString());const e=t instanceof s?t:s.fromAddress(t),r=this.mn.get(u(e));return r?Array.from(r).map(t=>this._n.get(t)):[]}fund(t,e){const r=Math.random().toString(),n=(new i).addData(r).to(new o(t,"testnet"),e).lock();n.time=Date.now(),n.confirmations=0,n.blockheight=-1,n.vn=0,this.sn.set(n.hash,n),this.Pn.add(n);const c=n.outputs[1],a={txid:n.hash,vout:1,script:c.script,satoshis:c.satoshis},u=n.hash+"_o1";this._n.set(u,a);const l=s.fromAddress(t),h=f(l.toBuffer()).reverse().toString("hex"),p=this.mn.get(h)||new Set;return p.add(u),this.mn.set(h,p),n.hash}block(){this.bn+=1;for(const t of this.Pn){t.blockheight=this.bn,t.vn=0;for(const e of t.inputs){this.sn.get(e.prevTxId.toString("hex")).outputs[e.outputIndex].spentHeight=this.bn}}this.Pn=new Set,this.On.clear()}}},function(t,e,r){const n=r(2),o=r(12),{F:i}=r(0);t.exports=class{constructor(t){let e=null;try{e=new n.HDPublicKey(t)}catch(e){throw new Error("Invalid API key: "+i(t))}this.network="mainnet"===e.network.name?"main":"test",this.apiKey=t,this.timeout=2e3}async pay(t){const e={tx:t.toJSON(),key:this.apiKey},r=`https://api.run.network/v1/${this.network}/pay`,i=await o.ue(r,e,this.timeout);return new n.Transaction(i)}}},function(t,e,r){const n=r(6);class o{constructor(t={}){this.cache=new Map,this.Sn=0;const e=void 0===t.maxSizeMB?10:t.maxSizeMB;this.An=Math.floor(1e3*e*1e3)}async get(t){n.parse(t);const e=this.cache.has(t),r=this.cache.get(t);if(e)return this.set(t,r),r}async set(t,e){n.parse(t);const r=this.cache.has(t),i=this.cache.get(t);if(r){if(!function t(e,r){if(typeof e!=typeof r)return!1;if("object"!=typeof e||!e||!r)return e===r;const n=Array.from(Object.keys(e)),o=Array.from(Object.keys(r));return n.length===o.length&&!n.some(n=>!t(e[n],r[n]))}(e,i)){throw new Error(`Attempt to set different states for the same location: ${t}\n\n${"This is an internal Run bug. Please report it to the library developers."}`)}this.cache.delete(t)}if(this.cache.set(t,e),!r)for(this.Sn+=o.xn(e);this.Sn>this.An;){const t=this.cache.keys().next().value,e=this.cache.get(t);this.cache.delete(t),this.Sn-=o.xn(e)}}static xn(t){switch(typeof t){case"boolean":return 5;case"number":return 9;case"string":return 2*t.length+1;case"object":{if(!t)return 5;const e=Object.keys(t);let r=1+4*e.length;return e.forEach(e=>{r+=o.xn(e),r+=o.xn(t[e])}),r}default:return 5}}}t.exports=o},function(t,e,r){const asm=r(20),hex=r(13);class GroupLock{constructor(t,e){this.pubkeys=t,this.m=void 0===e?this.pubkeys.length:e}script(){if(!Array.isArray(this.pubkeys))throw new Error("pubkeys not an array");if(this.pubkeys.length<1)throw new Error("pubkeys must have at least one entry");if(this.pubkeys.length>16)throw new Error("No more than 16 pubkeys allowed");const t=new Set;for(const e of this.pubkeys)t.add(e);if(t.size!==this.pubkeys.length)throw new Error("pubkeys contains duplicates");if(this.pubkeys.forEach(t=>hex(t)),"number"!=typeof this.m||!Number.isInteger(this.m)||this.m<1)throw new Error("m must be a non-negative integer");if(this.m>this.pubkeys.length)throw new Error("m must be <= the number of pubkeys");return asm(`OP_${this.m} ${this.pubkeys.join(" ")} OP_${this.pubkeys.length} OP_CHECKMULTISIG`)}domain(){return 1+74*this.m}}GroupLock.deps={asm,hex},GroupLock.originMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o4",GroupLock.locationMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o4",GroupLock.ownerMainnet="1CscRyquNBh5UAVYhfxvy1HfnQrSLe85MG",GroupLock.originTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o4",GroupLock.locationTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o4",GroupLock.ownerTestnet="mqvDyKXEfdbUYTepHbi3vvtCxRrGVDgGcb",t.exports=GroupLock},function(t,e,r){const{Jig}=r(3),expect=r(21);class Token extends Jig{init(t,e,r){if(expect(this.constructor).not.toBe(Token,"Token must be extended"),void 0!==e)return expect(e).toBeObject("bad token type"),expect(e.constructor).toBe(this.constructor,"bad token class"),this.In(t),e.Tn(t),void(this.amount=t);if(void 0!==r){if(expect(r).toBeArray(),expect(r.length).toBeGreaterThanOrEqualTo(2,"must combine at least two tokens"),r.some(t=>t.constructor!==this.constructor))throw new Error("cannot combine different token classes");const t=t=>r.reduce((e,r)=>r===t?e+1:e,0);if(r.some(e=>t(e)>1))throw new Error("cannot combine duplicate tokens");return this.amount=0,r.forEach(t=>{this.amount+=t.amount,t.jn()}),void this.In(this.amount)}this.In(t),expect(this.owner).toBe(this.constructor.owner,`Only ${this.constructor.name}'s owner may mint`),this.amount=t,this.$n(t,caller)}send(t,e){if(e=void 0===e?this.amount:e,this.In(e),expect(e).toBeLessThanOrEqualTo(this.amount,"not enough funds"),this.amount===e)return this.owner=t,null;const r=new this.constructor(this.amount-e,this);return this.owner=t,r}get value(){let t=this.amount;for(let e=0;e<this.constructor.decimals;e++)t/=10;return t}static combine(...t){return new this(void 0,void 0,t)}jn(){this.amount=0,this.owner="029d11c250cc84a6ffbaf84fc28da82fc4deee214021bed2dcaa22d5193d22e273"}Tn(t){this.amount-=t}In(t){expect(t).toBeNumber("amount is not a number"),expect(t).toBeInteger("amount must be an integer"),expect(t).toBeGreaterThan(0,"amount must be positive"),expect(t).toBeLessThanOrEqualTo(Number.MAX_SAFE_INTEGER,"amount too large")}$n(t,e){}}Token.decimals=0,Token.deps={expect},Token.originMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o7",Token.locationMainnet="0f99a89c41a857402973fe2d767de69488fbdaf54067a2b1eb500c9d0eb3d21a_o7",Token.ownerMainnet="1CscRyquNBh5UAVYhfxvy1HfnQrSLe85MG",Token.originTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o7",Token.locationTestnet="ddcee5e04c67c2077026d813b2315c69a871ad38b47209d83f9e213a15663c57_o7",Token.ownerTestnet="mqvDyKXEfdbUYTepHbi3vvtCxRrGVDgGcb",t.exports=Token}]);